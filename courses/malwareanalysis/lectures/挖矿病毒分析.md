# 挖矿病毒分析

## 挖矿病毒基本情况

### 感染现象

- CPU占用100%
- 驻留某些奇怪进程
- 开启web server等服务
- 与某些异常域名有访问往来

### 病毒功能
- 远程控制
- 挖矿
- 清理与免杀

#### 远程控制
- 恶意程序启动后，从资源里释放dll，并随即命名；
- 将释放的dll注册为RemoteAccess服务；
- 重新启动该服务以加载dll。
- 删除系统log日志
- 将自身复制为某类型文件，例如%ProgramData%\Aebbinroq.psd
- 向文件%ProgramData%\Aebbinroq.psd中写入大量随机数以避免查杀
- 注册%ProgramData%\Aebbinroq.psd文件为Web server 服务（例如tomcat服务）
- 恶意程序会在%TEMP%目录释放随即名dll文件，并调取其导出函数Install，安装该dll为类似正常的服务名，例如Microsoft corporation服务
- 服务器启动后获取并加密用户计算机版本信息发到服务器，等待远程指令。通过加密算法和加密方式可以推测恶意家族
- 恶意代码运行后还会将自身复制并随即命名，且在文件最后添加大量的0，使得大小呈现20M，这可以躲避一些杀毒软件的检查。随后将自己注册为系统服务。

#### 挖矿模块

- 木马启动后会在%TEMP%目录下释放某个可执行文件，该文件可能会将自己复制到系统目录下，例如%windir\w1ninit.exe%，这个程序运行后会创建如%windir\win1nit.exe%用于挖矿，该文件可能会加壳保护。
- 挖矿程序会首先访问服务器，获取挖矿信息，如矿池、矿工id，随后配置参数开始挖矿。

#### 清理模块
恶意木马运行最后会创建%TEMP%\ ~DeL!.bAt文件， 用来删除自身， 从而达到隐藏的 目的。

### 溯源：
- 分析木马访问的服务器域名
- 查dns、ip映射，可能能查到某国境内。 查询域名的whois信息发现，可能信息有隐私保护，未能查到有效的信息：
- 访问黑客服务器（例如http、ftp访问）可能有所发现
- 若能下载某些文件进行逆向分析，可能发现某个网址或信息，再查dns注册信息，进行黑客画像
- 

### 如何利用免费试用和免费增值账号创建僵尸网络

研究人员利用了电子邮件服务商Mandrill和 FreeDNS.afraid.org生成独一无二的邮件地址和不同的域名，自动化注册和验证，大批量创建云服务的免费账号，组建了一支基于云端的僵尸网络，控制数以百计的计算机。

这支僵尸网络部队有能力发起网络攻击、破解密码，每天挖到数百美元的莱特币矿……同时Rob Ragan和Oscar Salazar认为这种非劫持用户帐号的攻击是合法的。


他们的一个实验是挖掘莱特币，莱特币是次于比特币的第二大流行数字货币，比较适合用CPU挖矿。他们发现，每个账号每天能挖掘0.25LTC，整个僵尸网络云每周能生成价值1750美元的莱特币。为了避免造成真正的破坏，这个实验只持续了几小时，但留了一些继续挖矿，发现服务商根本没有注意到。

像Google, Heroku, Cloud Foundry, CloudBees等公司都允许开发者使用云资源部署应用，同时有很多开发者转卖例如亚马逊云主机空间。Rob Ragan和Oscar Salazar在150项云服务中测试了账号建立的过程，只有1/3需要账号验证信息。