# README

客户作为一家大型集团公司，拟构建一个管理薪酬的B/S应用。由于薪酬属于核心机密数据，所以在规划系统时同步考虑安全方案。

## 业务需求
有以下特点：
- 支持导入Excel薪酬表；
- 以Web页面展现复杂的薪酬计算方式和结果。
- 支持薪酬规则导入，并按规则对员工薪酬进行计算、展示；
- 最终结果可导入SAP薪酬系统。


## 安全需求

- 保障数据机密性，严防数据泄露
- 保障数据完整性，严防数据篡改
- 保障系统可用性，满足客户的业务需求
- 实现可追溯性，防止伪造、误用后的抵赖行为。


## 安全规划

### 管理管理
- 所有接触数据的人员均需签订安全保密协议，明确安全责任；
- 制定系统开发及使用的安全须知，并确保相关人应知尽知；
- 任何使用数据的行为需要授权和审计（记录）。

### 物理与环境
- 承载数据和计算的服务器必须存放于安全场所中
- 服务器的安全计算环境之中

### 网络安全
- 系统始终在内网运行
- 对访问系统的主机设立访问控制白名单


### 主机安全
- 访问数据的终端必须安装杀毒软件并保持最新更新
- 使用标准浏览器（最好经过安全加固）


  
### 应用安全
- 系统开发完毕后，需要经过代码审计
- 系统上线前，需要经过渗透测试

需要考虑的安全细节有以下多个方面：
#### 信息暴露

- 在系统中源代码、配置文件、脚本或其他任何相关文件中，不包含任何敏感信息
- 使用统一且无敏感信息暴露的报错页面，防止泄露系统技术信息或机密数据。例如，不能出现mysql类似信息。

#### 配置管理

- 审查网络配置文件，特别是默认的配置文件，按照“默认拒绝”、“最小特权”原则进行配置。
- 审查应用平台（web server）、中间件、第三方功能组件等的默认配置，按照“默认拒绝”、“最小特权”原则进行配置。
- 防止在旧文件、备份文件、未引用文件中出现信息泄露和旁路访问系统的路径。最好完全清理这些文件。
- 管理员访问接口或路径需要进行信息隐藏（不使用常见命名），防止目录扫描发现。
- HTTP方法（GET、POST等）在使用时应予以明确，防止使用其他方法绕过认证。
- 仅使用HTTPS，不使用HTTP。
- 审查富互联网应用的跨站策略误用。
- 确保所使用的各种软件升级到最新版本，如有例外，需要报告并制定防护措施。
- 启用各种日志，但不要记录敏感信息。日志服务器最好与应用服务器不同，并受到保护。
- 使用自定义端口，而不要使用熟知端口。例如不要使用3306等端口。
- 凡不必要的网络功能、接口、控制台命令均设为禁止或彻底移除。
- Web_server、db等软件在服务器上运行时，应使用相互独立的非特权用户，严禁使用root用户。

#### 身份管理
- 设立用户角色，用户操作前应根据角色进行授权，应当形成角色-权限矩阵文档，以便所有开发者都清楚。
- 用户不能以不同角色注册多个账户，注册身份需要被验证；
- 注册成功后，实名信息不能被修改；
- 防止通过一个用户名推测其它用户名；



特别考虑：
- 建议用户注册时以实名、身份证号码等真实信息进行注册；
- 建议设立访问白名单，白名单之外的用户禁止访问；
- 用户注册过程，建议使用人工审核过程，即用户申请后，需要管理员为其划分角色身份，之后才能成为正式用户。
- 建议使用双因素认证方式；

#### 身份认证
- 身份经过系统认证后，用户凭据必须经过加密信道传输（使用HTTPS）；
- 取消、清理或禁用各种软件的默认用户和默认密码，例如admin、test、test1234等；
- 不要为注册成功后的用户分配默认密码，防止个别用户疏于维护而被人滥用；
- 用户登录5次后需要锁定系统10分钟以上，防止暴力破解口令；
- 登录页面使用较高级的登录验证码，防止机器破解验证码；
- 登录后的会话ID等用户身份凭据信息使用cookie方式传递，而不要使用url，而且应当使用SHA256加盐或更安全的hash方法加盐进行处理，防止猜测破解；
- 不设计“记住我”等记住用户凭据的类似功能；
- 用户密码长度应当不少于8位，且包含大小写字符、数字和特殊符号；
- 密码找回功能应慎重设置，防止熟人猜测进入系统；
- 防止用户修改他人密码或重置密码；
- 使用统一的身份认证，防止出现旁路绕过；


特别考虑：
- 建议使用下列http请求报文头：

```
Cache-Control: no-cache, no-store
Expires: 0
Pragma: no-cache
Cache-Control: must-revalidate,max-age=0,s-maxage=0
```

#### 授权管理

- 设置字符过滤，过滤诸如：```..  /  //  \\```等字符，避免攻击者进行目录遍历和文件包含；
- 为每个角色都进行明确的授权，并记录授权日志；
- 为每个用户的设置操作日志；
- 设置超时自动注销功能，注销后用户凭据将被清理，用户必须重新登录才能进行浏览和其它操作；
- 防止注入攻击产生的越权访问，各种查询、排序都应使用预编译的参数化查询语句，禁止硬编码拼写查询语句；

特别建议：
- 建议设置数据库事务和日志，防止用户误操作，以便回滚。

#### 会话管理

- 服务器HTTP响应头中应设置```Set-Cookies:Secure;HttpOnly;SameSite=Strict```等 ；
- 维持用户状态的会话凭据（cookie），应当在HTTPS下传输；
- 保障每个用户每次访问的会话ID随机性，确保其不可预测、不可篡改、到期过期，防止猜测和重放；
- 用户注销、用户重新登录、超时注销、用户在不同IP同时登录等动作发生后，原用户会话ID必须强制设为无效；
- 使用web框架等的内建防止CSRF的机制；
- 


#### 信源加密：
- Excel 文件需要加密，防止导出后机密泄露
- 数据库需要加密

#### 信道加密：
- 使用tls
- 使用https

#### 访问控制：

- 用户会话超时设置尽可能低（30min以内）
- 用户操作基于角色进行授权，最好基于属性进行授权（考虑时间、地点、设备等）

- 用户认证、授权、操作应记入日志，建立审计机制

#### PKI

- 使用企业可信的权威数字证书
- 用户浏览数据前下载证书
- 数据经https到桌面浏览器
- 更改数据使用u key 或密保卡








## 安全实现

### Excel 导出时的安全加密

Excel导出时，需要进行数据加密。

### 