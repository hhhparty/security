# SDP

软件定义边界（Software Defined Perimeter，SDP）由云安全联盟（CSA）于2013年提出，用应用所有者可控的逻辑组件取代了物理设备，只有在设备证实和身份认证之后，SDP才提供对于应用基础设施的访问。SDP使得应用所有者部署的边界可以保持传统模型中对于外部用户的不可见性和不可访问性，该边界可以部署在任意的位置，如网络上、云中、托管中心中、私有企业网络上，或者同时部署在这些位置中。



软件定义边界（Software Define Perimeir，SDP）是“远程访问新范式”、零信任、基于身份的细粒度访问的一种实现。

## 概念

SDP包含两部分：SDP主机和SDP控制器。SDP主机可以创建连接或者接受连接。SDP控制器主要进行主机认证和策略下发。SDP主机和SDP控制器之间通过一个安全的控制信道进行交互。

<image src="images/sdp/SDP架构.jpg">

### SDP 工作流
SDP工作流如下：

- 一个或多个SDP控制器上线，并且和可选的认证和授权服务建立连接；
- 一个或多个可接受连接的SDP主机上线，这些主机与控制器建立连接并被控制器认证。然而，这些主机并不对其他主机的通信进行应答，也不会响应非预分配的请求；
- 每一个发起连接的SDP主机（例如浏览器）上线，它和控制器建立连接并被控制器认证；
- 在认证通过后，SDP控制器确定一个发起连接的主机可以被授权通信的主机列表；
- SDP控制器通过加密信道通知可接受连接的SDP主机，以及一些可选的策略；
- SDP控制器将可接受连接的主机的列表和可选的策略发送给发起连接的主机；
- 发起连接的SDP主机与所有授权的可接受连接的主机之间建立Mutual TLS连接。

<image src="images/sdp/SDP工作流.jpg">

### DP 带来的改变
- SDP改变了传统的网站连接方式。
  - 在传统的连接中，首先，客户端需要建立与服务器端的连接，这一步骤使服务端暴露在公网中，若服务端有漏洞，则有可能被利用；
  - 其次，用户通过登录页面输入用户名和密码，这一步骤有可能使得用户名和密码被窃取；
  - 最后，除用户名和密码外还可使用多因素认证，通过多因素认证，可以抵抗用户名和密码的丢失，但是多因素认证对于用户而言不是很友好。

在SDP中，首先，客户端进行多因素认证，认证设备的可靠性等，这一步对用户而言是透明的。认证通过之后，才进入用户登录阶段。这两步均是客户端与Controller进行交互，不涉及对于具体服务的访问。当认证通过后，客户端才能够与可访问的服务建立连接。

因此，SDP通过三种方式对抗基于网络的攻击：
- 透明多因素认证可以抵抗用户凭据丢失
- 服务器隔离可以抵抗服务器利用
- TLS双向认证可以抵抗连接劫持。

SDP可以提供对于网络系统、服务和应用的以人为中心、可管理的、普遍存在的、安全的和敏捷的访问。它解决了TCP/IP中的一个设计漏洞（在认证之前即对报文进行处理）。由于SDP的部署代价更低，因此，SDP可能颠覆网络防火墙和VPN技术。SDP同样有可能颠覆传统的网络安全技术部署，如NAC，Switch-to-Switch加密，内部的VPN能力。这是因为SDP的软件Agent技术可以部署在任何其支持的操作系统上，从而创建一个及时的和动态的网络边界。

## VPN 的问题

### VPN 授权机制不够灵活

VPN 合法用户与内网用户往往具有相同的访问权，这个权限通常与划分不同的可信域原则、最小特权原则等安全原则相悖，而且一般的VPN产品不能根据用户要求，灵活设定访问权限策略。

> 替代方案是在VPN服务器串行连接统一认证授权系统。


SDP可以灵活设置权限策略，限定不同用户的可访问内容。

### VPN 用户体验较差

用过企业VPN的人就知道，速度慢和不可靠是常见现象。如果在多个地点使用应用，不断重连和断开的体验令人心生恼怒，而且根据所需应用不同，用户还得跟踪记录自己都是在哪儿登录的。

SDP 用户终端连接一次即可访问所需应用，速度较快，用户体验好，基于浏览器的无代理解决方案使应用访问很简单。

### VPN管理复杂度价高

涉及系统迁移时，VPN管理复杂度会很高，涉及到VPN配置和防火墙配置。

完全基于云的SDP可以简化管理过程，可以和VPC相协同。

### VPN扩展成本较高

随着公司企业要求更多用户连接和跨多云实例部署，VPN/防火墙的成本随所需许可和更高端设备的增加而快速上升。

云原生SDP解决方案中，扩展从来不是个问题。无论需连接的用户数有多少，无论需被访问的应用有多少，SDP解决方案都有能力在云端无缝扩展，无需高价购买硬件。


因为SDP Controller和AH拒绝无效数据包（大概来自未授权的用户），他们可以防止与未授权用户或设备建立TCP连接，从而可以减轻DDoS攻击。

SDP 优势
现有技术缺点
VPN 技术
VPN很好地为远程用户提供对VLAN或网段的安全访问，就好像它们实际存在于企业网络上一样。这种技术，特别是当与多因素认证相结合时，对于具有传统边界的企业以及静态用户和服务器资源来说效果很好。但是正如Gartner所说，“DMZ和传统VPN是为20世纪90年代的网络设计的，已经过时，因为它们缺乏保护数字业务所需的敏捷性。

VPN有两个缺点，使得它们不适合当今的需要。首先，它们对所分配的网络提供非常粗粒度的访问控制，要么全部都可以访问，那么不能访问。尝试配置VPN以为不同用户提供不同级别的访问是不现实的。

第二，即使公司对VPN提供的控制级别感到满意，VPN也是一种只能控制远程用户的孤立解决方案。它们不会帮助保护内部用户，这意味着组织需要一组完全不同的技术和策略来控制内部部署用户的访问。这将使协调和对准这两个解决方案所需的工作量增加一倍以上。

Gartner指出：“到2021年，60％的企业将逐步淘汰VPN，而使用软件定义边界（尽管2016年SDP的使用量不到1％）。

跳板机（Jump Box）
跳板机（Jump Box）是一个服务器，目的是为了使不安全区域的用户访问在更安全区域中运行的服务器或服务。对于本文档，使用Jump Box的场景是使用Jump Box 来代理访问云环境中的服务器。



如上图所示的Jump Box的网络访问可以是公开的，通过直接连接可访问，或由VPN控制。 访问Jump Box桌面本身需要用户认证（多因素）。Jump Boxes通过对受管理的服务的强制单点访问来控制对云资源的访问。 然而Jump Boxes有一些限制，使它们不适合广泛的云资源访问。

不是多用户系统，用于单用户访问受保护的服务器
设计用于偶尔访问，例如由系统管理员访问，而不是用于不断的进行的访问
对跳板机后面的网络上的所有服务器，要么认证通过，所有的服务都可以访问，要么认证不通过，不能访问。
如果攻陷了跳板机或可以访问跳转的用户的设备，就可以打开整个网络。
难以跟踪用户访问以实现合规性检查
所以跳板机不是云系统访问控制的合适解决方案。

SDP 优势总结
策略是基于用户的，而不是基于IP地址
因为SDP系统是以用户为中心的,它在要求任何访问之前都需要对用户和设备进行验证，允许企业根据用户属性创建访问策略,执行最小特权原则，具有更细粒度的访问控制。通过利用目录组成员身份，IAM分配的属性，角色等方面，公司可以以某种有意义的方式定义和控制对云资源的访问，这对公司业务，安全和合规性很有意义。而传统的网络安全仅基于IP地址，根本不考虑用户。

身份管理
SDP和IAM在几个方面自然互补。

首先，SDP实现通常被设计为利用已经部署的IAM系统进行认证，从而加速SDP的推出。此身份验证可通过LDAP或AD服务器，或使用标准（如SAML）进行。

其次，SDP实现通常使用用户的IAM属性——例如目录组成员身份，目录属性或角色——作为SDP策略的元素。

最后，SDP系统也可以包括在由IAM系统管理的身份生命周期中。例如，当IAM系统创建新帐户时，SDP系统应同时创建相应的网络权利。

SDP Controller信任第三方IAM系统用于用户身份认证和用户身份生命周期管理。因此，当第三方用户在其IAM系统处停用时，用户将自动无法访问受SDP保护的资源，因为他们无法再通过联合身份验证。这个联合很好地解决了第三方访问的常见问题。

预认证和预授权
SDP依靠预认证和预授权作为其两个基本支柱。在认证和授权之前不会有任何数据包到达服务器，从而可以使云资源对未授权用户完全不可见。这完全消除了许多攻击向量，包括暴力攻击，洪水攻击，以及基于TLS漏洞的攻击，如Heartbleed和Poodle。

运营效率
与实现给定级别的安全通常所需的手动工作相比，由SDP执行的自动化策略实施提供了显著的操作益处。

简化合规性
由于AH记录日志和控制所有IH的网络流量，所以SDP可以提供详细的对每个用户访问的可见性，所以SDP能够根据这些信息自动提供合规性报告。

降低成本
SDP可以通过几种方式帮助组织降低成本。首先，减少IT任务所需的手工劳动量。这将直接降低外包IT模式的成本，并减少雇用额外工作人员的需要。第二，精简合规性将减少准备和执行审计所需的时间和精力。这两个活动都需要第三方顾问，每一小时的时间节省是直接的成本节约。最后，SDP作为其它技术（例如NAC）的替代还可以帮助组织节省资金。