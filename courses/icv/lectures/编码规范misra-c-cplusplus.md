# 编码规范

早在1990s，汽车行业对电子设备的需求开始激增，软件成为非常重要的组成部分。这一认识出现的同时，另一件事也变得被人们所接受，软件的质量直接与商业和安全相关。

MISRA（汽车公业软件可靠性协会 the Motor Industry Software Reliability Association），由UK政府资助。该组织1994年发布的“Development Guidelines for Vehicle Based Software”，是后来出现的 IEC 61508 标准, “Functional Safety of Electrical / Electronic / Programmable Electronic Safety-related Systems” 的解释。这个文档后来被 ISO 26262 Road Vehicles, Functional Safety 所取代。

MISRA 工作组已经发布了一系列的定位C和C++语言问题的指引。2019 年 1 月，MISRA®宣布将 AUTOSAR C++ 编码指南与 MISRA C++ 集成。整合这两组指南将为 C++ 最佳实践编程提供单一的事实来源。

## 概念

### 什么是代码规则和指引？
确保软件达到一下目标：
- safety：软件使用不会造成危害
- secure：不能被入侵/黑
- reliable：能够每次按其应当执行的执行。
- testable：可以被在代码级进行测试
- maintainable：可以维护，甚至随着代码基的增长
- portable：在相同环境条件下，可完成相同的工作

### 为什么编码规范很重要？
编码标准之所以重要，是因为它们有助于确保安全性、保密性和可靠性。

每个开发团队都应该使用一个。即使是最有经验的开发人员也可能在没有意识到的情况下引入编码缺陷。而这一缺陷可能会导致一个小故障。或者更糟的是，严重的安全漏洞。

使用编码标准有四个主要好处：

1. 符合行业标准（例如，ISO）。

2. 始终如一的代码质量——无论谁编写代码。

3. 从软件安全入手。

4. 降低开发成本并加快上市时间。

在嵌入式系统行业中，需要（或强烈推荐）这些标准才能合规。对于功能安全标准尤其如此，包括：

IEC 61508：“电气/电子/可编程电子安全相关系统的功能安全”
ISO 26262：“道路车辆——功能安全”
EN 50128：“铁路应用——通信、信号和处理系统——铁路控制和保护系统软件”
IEC 62061：“机械安全：电气、电子和可编程电子控制系统的功能安全”
每一个都是为特定的编程语言编写的。大多数嵌入式系统开发人员使用 C 或 C++。

### 重要的 C 编码标准
C 编程语言很灵活。它也以高性能着称。这就是它在嵌入式开发人员中流行的原因。

但 C 也容易出现风险。C 代码可以用未定义的行为编译。这种未定义的行为会使您的代码容易出现漏洞和缺陷。或者，当您的 C 代码移植到不同的硬件时，它可能无法预测。

使用 C 编码标准是查找未定义和不可预测行为的明智方法。

有几个既定的标准。有些是专门为功能安全而设计的——例如MISRA。其他人则专注于安全编码，包括CERT。

### 重要的 C++ 编码标准
C++ 编程语言比 C 更大、更复杂。与 C 一样，C++ 也很灵活。它以高性能而著称。  

但要拥有可维护的代码库，使用 C++ 编码规则很重要。这将帮助您确保未定义和不可预测的行为不会出现在您的代码中。

C++ 有几个既定的标准。有些特定于关注功能安全的嵌入式行业，包括MISRA、AUTOSAR和JSF AV C++。其他设计用于安全编码，例如CERT。

### 如何通过静态代码分析执行 C 编码标准和 C++ 编码标准
你可以有一个编码标准——但这并不意味着它被遵循。

静态分析器（例如Helix QAC或Klocwork）是确保它们得到执行的最佳方式。通过使用自动静态分析，您可以在花时间进行同行代码审查之前确保您的代码符合要求。此外，这使代码审查和测试阶段更加有效。

### 如何实现 MISRA 合规性？
实现 MISRA 合规性需要知识、技能和正确的工具。

以下是遵守 MISRA 的七个步骤：

1. 了解规则
您需要了解与您使用的 C 或 C++ 版本相关的 MISRA 编码规则。

2. 不断检查你的代码
不断检查你的代码是否有违规行为是提高质量的最好方法。

3. 设置基线
嵌入式系统带有遗留代码库。通过设置基线，您可以专注于确保您的新代码是合规的。

4. 根据风险
对违规行为进行优先级排序 您的代码中可能有数百甚至数千个违规行为。这就是为什么根据风险严重程度对违反规则进行优先级排序很重要的原因。一些静态代码分析工具可以为您做到这一点。

5. 记录你的偏差
有时规则也有例外。但是在合规性方面，每个规则偏差都需要有据可查。

6. 监控您的 MISRA 合规性
密切关注您的代码是否符合 MISRA。使用静态代码分析器通过自动生成合规性报告使这更容易。

7. 选择合适的静态代码分析器
选择合适的静态代码分析器让一切变得简单。它负责扫描您的代码（新代码和旧代码）以查找违规行为。它根据风险对漏洞进行优先级排序。