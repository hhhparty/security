# 汽车总线

http://www.interfacebus.com/Design_Connector_Automotive.html

随着ECU增多到上百个，车内各控制器的交互需要进行大量数据交互。数据交互包括Lin、can、canfd、flexray、车载ethernet等。其中成本低、可靠性高、应用普遍的有Lin、CAN通讯，而FlexRay、车载Ethernet等基于成本因素，目前主要在高端车型中使用（FlexRay后续得到普遍应用的可能性较小，楼主主要认为其比较尴尬，首先成本方面接近车载以太网而通讯速率又远低于它，而伴随着未来智能化、网联化的趋势，车载Ethernet在未来得到推广的可能性要比FlexRay高很多）。


从规格上，可以将车载总线分为6类：
- class A：一种多路布线系统，通过在同一信号总线上发送和接收多个信号来减少布线。这个多用途布线取代了执行相同功能的单独导线。
  - 通常比特率低于 10kbps
  - 使用 UART 通信

- class B：在节点之间传输数据的多路布线系统，这些节点取代了现有的独立模块。
  - B级用作非关键的 10kbps ～ 125 kbps总线
  - 例如：J1850


- class C：通过使用实时高数据信号，减少布线的多路布线系统。
  - 速率在125kbps ～ 1Mbps之间
 
- Emissions/Diagnostics
  - 处理 emissions 或诊断总线。
- Mobile media：处理移动媒体装备。
- x-by-wire：是一种接入额外电子系统到车辆的各类总线统称，以便增强或替代已有机制。

车辆工作温度要求：-40摄氏度 ～ +125 摄氏度

具体总线的用途：
- LIN：最低速数据传输
- CAN：中速数据传输
- MOST：高速
- FlexRay：关键功能安全应用，例如加速、刹车

### MOST

Media Oritened Systems Transport，定义了一个多媒体光纤（低开销、低成本）点到点网络，在塑料光纤（POF）上以环形、星形或菊花链拓扑实现。

MOST总线规范定义了物理（电气和光学参数）层以及应用层、网络层和介质访问控制。

MOST总线为汽车媒体娱乐网络（视频、CD..）提供光学解决方案。

### J1850 总线

SAE J1850 总线用于车辆诊断和数据共享应用。它的接口有两类：
- 41.6Kbps PWM 两线差分方法
- 10.4Kbps VPW 单线方法

最大线长35米，最大节点32.

于1994年开发，是class B 类协议。

### MI Bus 

MI Bus 是一种用于一主多从的串行（单线）通信协议。
- MI 总线可能应用于驾驶后视镜、座椅、车窗升降器或前照灯调平器。
- 主设备向总线上的所有从设备发送地址和数据（the Push Field)。
- 具有相同地址的从机用请求的信息(the Pull Field)进行响应。
- 推送字段包含起始位(低3位)、同步位(双相编码0)、数据字段(5位双相编码)和地址字段(3位双相编码)。
- Pull字段包含一个同步位[bi phase encoded 1]、数据字段[3 bits encoded NRZ]和一个帧结束字段(~3个20KHz方波周期)。
- 单线线路在逻辑0(0.3v最大)和逻辑1(+5伏)之间运行。

### DSI Bus

Distributed Systems Interface 由motorola开发，作为一种专门的安全总线。
DSI 是一种双线的串行总线，连接着safety相关传感器和组件。

### BST Bus

Bosch-Siemens-Temic 总线是另一类车辆安全总线，用于连接空气气囊等。

BST 总线是一种 2-wire 总线，使用 Manchester 编码、Parity 或 CRC 作为错误校验和检查。BST总线速度最大位 250 kbps

### MML Bus

MML Bus 即移动多媒体link 是一种多媒体总线。使用塑料光纤技术，以星型拓扑进行主/从通信方法。

MML 总线可以以100Mbps速度，10米长内传输。编码使用NRZ编码。这种总线具有容错性，且支持即插即用。

### Byteflight SI-BUS

Byteflight 用于安全关键应用，例如安全气囊。是一种TDMA协议，运行速度10Mbps ，2线或3线塑料光纤总线。

可以星型、集群配置。

### FlexRay 

是一种面向车内网的高速串行（同步或异步）通信系统，它使用P2P（Star 拓扑）连接。

速度 10Mbps、容错、使用双绞线（UTP or STP）。

FlexRay 是 byteflight的扩展协议，常见的应用包括：steer-by-wire 和 brake-by-wire

### domestic digital data bus （D2B）

D2B 是一种光数据总线系统，用于连接audio、video、计算机和电话组件，以单一环结构连接的车内网。奔驰使用了一个结合型的环和星型光（650nm）拓扑，速率 5.6 Mbps（最大 20Mbps）。

D2B 接口最大光纤距离位10米（1 coupler） 或 7 米（2 couplers）

### SMARTwireX 

SMARTwireX 定义了一个电子物理层，支持D2B 网络，运行速度25Mbps。该协议运行在标准低成本 UTP 线上，使用全自动EMC能力。

### IDB 1394 Bus
IDB 1394 Bus 是汽车版本的IEEE 1394协议。

IDB-C是第一个车内串口通信网络协议族，由 SAE J2366-ITS 数据总线标准。

它基于CAN 2.0B silicon 和物理层，标准化在 SAE J2284-高速CAN。

有4个层次：
-  J2366-1, Physical Layer
-  J2366-2, Link Layer
-  J2366-4, Thin Transport Layer
-  J2366-7, Application Message Layer.



The IDB is primarily used as a consumer device bus operating over an unshielded Twisted Pair [UTP] multidrop cable.

### IEBus 

Inter Equipment Bus 用于车内总线，支持半双工异步（多主）通信，使用CSMA/CD作为访问控制。

使用两路差分线路：Data+/Data-。
两种模式定义：Mode 0 使用 16 bytes。

### LIN 

local interconnect network 用于车内通信和网络连接各类智能传感器和执行器的串行总线。

是一种Class A 协议，最大 19200 波特率，最大线长 40米。

### CAN 

### Intellibus 
Intellibus is a multi-drop communications bus developed by Boeing initially for military avionics applications, but also has an application in the automotive field. Similar to CAN in concept with similar limitations and inefficiencies. Intellibus operates at bus speeds of 12.5Mbps. Intellibus is used with electronic engine control, transmission, and other vehicle systems as another Drive-by-Wire protocol.
Intellibus uses a Master/Slave approach with Manchester Bi-Phase bit encoding over a twisted pair wire. The maximum bus length is 30 meters, at 12.5Mbps to a maximum of 64 nodes.
Intellibus provides both parity and CRC error detection. A class B, and Class C bus.

Intellibus Interface Module [IBIM]
Intellibus Network Interface Controller [INIC]
Intellibus Chassis Interface Module [CIM]

### OBDII Bus Description

OBD2 [On-Board Diagnostics II] defines a communications protocol and a standard connector to acquire data from passenger cars. It was required by U.S. EPA on all gasoline powered cars and light duty trucks manufactured for the U.S. after 1996 to help monitor/inspect vehicle emissions.
OBDII will light a lamp called a MIL (malfunction indicator lamp), also known as the "check engine" light on the dash.
The OBD-II standard allows for multiple electrical interfaces, which complicates the hardware used to interface with the vehicle. OBDII data as defined by the SAE J1979 standard
For a detailed description, Engineering Data, and circuit Interface implementation; see the OBDII Bus page.
	
OBDII to 15-pin Dsub Cable
OBDII Cable

{Automotive Buses Index}
SAE J1708 Bus Description

Serial Data Communications Between Microcomputer Systems in Heavy-Duty Vehicle Applications. J1708 defines the physical layer only. J1708 uses the RS485 bus as the electrical layer.
The cable is a 2-wire 18 AWG wire with a maximum distance of 40 meters. Class A operating to 9600bps. A message starts with a Message Identification Character [MID], followed by Data characters and then a checksum.
The total message length is 21 or less characters. Each character is 10 bits, each character begins with a Start bit [logic low].

{Automotive Buses Index}
### Vehicle Area Network

VAN An automotive bus developed by Peugeot and Renault [early 1990's].
The VAN bus is a differential bus with Enhanced Manchester Data Encoding.
The Two-wire data bus consists of 'Data' and 'DataB'.
The VAN network may have one or more Masters and some number of Slaves.
The VAN Networking Topology may be interconnected in a number of different architectures.
VAN may be either a BUS, Ring, Tree or Star style using broadcast or point-to-point communications.
ISO standard 11519-3 [VAN Protocol]. Transmission speed 160kHz [estimate].
IC Interface MTC-30521, Alcatel. VAN Data Link Controller TSS461F, Atmel.
The resistors [R2] shown in the graphic are for impedance balance of the VAN Bus.
Resistors R1 and Capacitors C1 form a low pass filter [Ri / RiB] which then feeds the comparators.
The normal circuit output is from Ro. However is either Data or DataB fail, the output can still be reconstituted.
The Ro can be used with one of the two supplementary comparators [either R1 or R2] to allow communication, even though one line has failed.
	
VAN Receiver Schematic
VAN Receiver Schematic

### Planet

Planet [Philips Lite Automotive NETwork] is used as an in-vehicle [Automotive] network designed for safety-critical network concept for dedicated passenger-restraint systems, air bags.
Planet uses two wires for the transmission of power, data and clocking. Planet has its own Protocol.
The Philips Lite Automotive NETwork was developed by Philips [now nxp] and Special Devices Inc.
The first device to interface with the Philips Lite Automotive NETwork was released in 2000.

The only identified device: nxp; AU6101 squib driver IC {air-bag electronic initiator}
Editor note, Philips Semiconductors is now called nxp. 

### 其他
Additional notes for Automotive Buses:
ISO 15765 [CAN] - Controller Area Network, a new higher speed interface
ISO 9141-2 is a name of the upper protocol for automotive failure diagnosis using a UART interface.
This communication speed is 9.6kbps. [used by Chrysler and import vehicles]
ISO 11992 truck/trailer point-to-point interface with a physical layer over twisted pair (CAN_H and CAN_L) for the transmission of the differential signals. The signal voltage levels are different from ISO 11898-2. The voltage levels for a dominant bit are specified as 2/3-supply voltage for CAN_H and 1/3-supply voltage for CAN_L. A recessive bit is represented by 1/3-supply voltage for CAN_H and 2/3-supply voltage for CAN_L.
ISO 14230, or KWP2000 (Keyword Protocol) shares the electrical portion of ISO9141 standard, but defines it's own commands.
PWM J1850-41.6 See the J1850 topic listing, (41.6Khz Pulse Width Modulated) [used by Ford vehicles]
VPW J1850-10.4 See the J1850 topic listing, (10.4Khz Variable Pulse Width) [used by GM vehicles]
SAE J1587 Joint SAE/TMC Recommended Practices for Electronic Data Interchange Between Microcomputer Systems in Heavy-Duty Vehicle Applications
E&C Bus [Entertainment & Comfort] bus used in GM vehicles to control the radio and HVAC controls. E&C Bus is a class A protocol using 1 wire, with PWM bit encoding at a maximum of 1kbps over a 20 meter cable.
Ford uses a proprietary Standard Corporate Protocol (SCP) for Module communication, and an audio corporate protocol {ACP) for audio communication.
BEAN bus is a Class A protocol running up to 20kbps over a 40 meter single wire cable.
I2C Bus {listed on it's own page} is defined as a class A protocol and was used as a HVAC bus by Renault.
USB Bus {listed on it's own page}. USB has a Slow-Speed mode of 1.5Mbps is used for devices such as mice. Full-Speed mode is used by most devices and allows a transfer rate of 12Mbps. High-Speed mode [defined by USB 2.0] allows rates of 480Mbps. Up to 127 devices may be connected together in a tiered Star topology over a maximum cable length of 4 meters.
1394 FireWire Bus {listed on it's own page}. The differential cable version operates at 100, 200, or 400Mbits/sec, [800Mbits/sec for 1394b] using half-duplex [full duplex 8B/10B encoding for 1394b]. Firewire supports up to 63 devices at a maximum cable distance between devices of 4.5 meters. With a maximum of 16 devices on the bus allows a total maximum cable distance of 72 meters. Transmitting data over CAT5 cable allows data at 100Mbps to travel 100m [1394b].
SCI Bus {listed on it's own page} is defined as a class A protocol.
ACP is a class A protocol running over twisted pair wire at 9600bps for a maximum distance of 40 meters
Safe-by-Wire [SdW] protocol describes the physical Layer, Data Link Layer, and Application Layer. Safe-by-Wire uses a two wire differential pair, with three data levels. Normal data level '0' is transmitted at 6 volts. Normal data level '1' is transmitted at 3 volts. The power distribution level is at 11 volts, and the safing level is at 0 volts.
SINEBUS protocol, a single wire bus used in audio applications operating up to 200kHz over a cable of 10 meter maximum. SINEBUS is a class A protocol. SINEBUS uses SAM bit encoding.
GMLAN (General Motors GM) microcontroller network using the CAN protocol. A Class B bus

Diagnostic Trouble Code Acronyms

APS/IVS; Accelerator Pedal Position Sensor and Idle Validation Switch
BAP; Barometric Absolute Pressure
CKP; Crankshaft Position
CMP; Camshaft Position
DTC; Diagnostic Trouble Code
EBT; Exhaust Back Pressure
ECI; Engine Crank Inhibit
ECL; Engine Coolant Level
ECT; Engine Coolant Temperature
EFAN; Engine Fan Control
EGR; Exhaust Gas Recirculation
EOP; Engine Oil Pressure
EOT; Engine Oil Temperature
GPC; Glow Plug Control
IAT; Intake Air Temperature
ICP; Injection Control Pressure
IDM; Injection Driver Module Power
IPR; Injection Pressure Regulator
MAP; Manifold Absolute Pressure
MAT; Manifold Air Temperature
PCM; Powertrain Control Module
VGT; Variable Geometry Turbocharger
VSS; Vehicle Speed Sensor


## 通信加密

https://zhuanlan.zhihu.com/p/105353137


### CAN 
为了加强CAN的安全性，在CAN负载中