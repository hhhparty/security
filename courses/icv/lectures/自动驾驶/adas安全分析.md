# 自动驾驶预控制器安全分析

自动驾驶域控制器，简称为 ADU 或 ADAS 域控制器，它集成了众多感知单元，具有集中大算力，能够作为自动驾驶的大脑，融合来自摄像头、雷达、超声波、高精定位和地图数据，用于感知和决策。

> 《汽车整车信息安全技术要求》征求意见稿中关于自动驾驶相关要求：
> 6 车辆网路安全管理要求
> 6.8　零部件应具备安全防护措施，保障软硬件及系统的安全性。
> 注：零部件具备的安全防护措施包括加密通信、身份认证、安全存储等。
> 6.10　无意识行为要求
> 6.10.1　车辆应采用默认安全设置
> 6.11　车外收集的视频、图像、人脸、车牌数据，以及车内通过摄像头、红外传感器、指纹传感器、麦克风等传感器等收集的数据应满足国家法律法规及国家标准等相关要求。
> 7.2　短距离无线和传感器
> 7.2.1　应对传感器采取电磁干扰屏蔽措施。
> 7.2.2　应对短距离无线系统电磁抗干扰攻击产生的故障进行检测。
> 7.3　后台服务器
> 7.3.1　车辆与后台服务器通信之前，应实施安全身份认证。
> 7.3.2　车辆在与后台服务器失去通信、后台数据丢失或无法提供后台服务的情况下，应能够保障与车辆驾驶相关基本功能正常，或采取相应措施以保障行车安全。

7.4　第三方应用环境
7.4.1　应对第三方应用的真实性和完整性进行检验。
示例：第三方应用包括第三方娱乐应用等。
7.4.2　应对第三方应用的访问资源进行访问控制，禁止安装和运行非法使用控制外的资源应用。

7.5　外部接口
7.5.1　应对USB端口接入设备中的文件进行访问控制，只允许媒体文件读写或指定签名的应用软件安装或执行。
7.5.2　应对Jtag接口、其他调试接口进行访问控制保护，禁止非授权用户访问。
注：	外部接口包括USB接口、OBD接口和其他接口等。
7.5.3　应具备抵御USB端口接入设备中的病毒程序和携带病毒的媒体文件/应用软件的能力。
7.5.4　通过OBD接口发送写操作请求时，应采用身份鉴别、访问控制等安全策略。
注：写操作请求包括基于UDS协议的Control、Clear、Reset请求。
7.5.5　车辆应根据风险评估结果，对调试接口采取安全措施，对于高风险零件应关闭、禁用调试接口或设置安全的访问控制机制。
7.5.6　车辆外部连接系统（包括远控功能系统、短距离无线和传感器、第三方应用、外部接口等）不存在由权威漏洞平台6个月前公布且未经处置的高危及以上的安全漏洞。
注：处置包括消除漏洞、制定减缓措施等方式。
7.5.7　车辆应关闭不必要的网络端口。

8.2　防止未授权的操作
8.2.1　应采用完整性保护和校验机制，以防止通过通信通道注入篡改的代码。
示例：例如通过通信通道注入被篡改的软件二进制代码到通信流中。
8.2.2　应对车辆内部网络进行安全区域划分，对区域边界进行防护，对于不需要通信的物理设备之间至少应实现逻辑隔离。
示例：对于以太网可采用VLAN技术实现不同功能域之间的逻辑隔离。
8.2.2.1　车辆通信应采取隔离措施，隔离车辆内部通信网络和车辆外部通信网络
注：	隔离措施包括采用物理隔离、黑白名单、防火墙等措施。
示例：车内网络可根据功能需要进行隔离，并对跨域请求进行访问控制，访问控制列表应遵循默认拒绝原则及最小化授权原则。
8.2.3　应采用访问控制及相关技术，防止来自外部通道的消息对车辆数据/代码的非法操纵、覆盖、清除，或非法数据代码写入。
8.2.4　应具备对与外部存在通信的零部件的身份识别机制。
8.3　通信消息的真实性有效性
8.3.1　车辆应验证所接收消息的真实性，以防止接收不可靠或不可信来源的消息信息，或遭受中间人攻击/会话劫持。
8.3.2　车辆应验证所接收消息的有效期或唯一性，以防止遭受重放攻击。
示例：如车辆的远程控制服务器传输的车控指令，车端通过校验该类指令的有效期或唯一性，可防止车控指令被用于重放攻击。
8.4　防止信息泄露
8.4.1　向车辆传输或从车辆传送的机密数据应受到保护，通过建立相应的机密性保护措施，防止因车辆的通信信息被拦截、干扰辐射或通信监听而导致的敏感信息泄露。
注：机密数据包括整车故障报警数据、车辆控制类数据、个人敏感信息等。
8.4.2　应通过访问控制及相关技术，防止对个人或系统的重要数据或文件的未经授权的访问。
注：安全控制的例子可在OWASP中找到。
8.5　防止拒绝服务攻击
8.5.1　应采取措施检测拒绝服务攻击，并应从该类攻击中恢复，防止通过通信（包括车外通信和车内通信）通道注入大量垃圾数据到车辆通信系统中导致其不能正常提供服务。
8.5.2　应采取措施检测黑洞攻击并从该类攻击中恢复。
注：黑洞攻击可能用于阻止传递给其他车辆的信息，从而中断车辆之间的通信。
8.6　应采取措施检测和防止非特权用户获得对系统的特权访问。
注：非特权用户可能通过调试接口获得系统的根用户权限。
8.7　防止病毒入侵车辆系统
应通过识别恶意代码攻击等技术措施，识别病毒通过通信媒介的入侵行为。
8.8　防止接收恶意消息（恶意消息的定义？更加准确的描述“恶意”）
8.8.1　应具备检测恶意内部消息或行为的措施。
注：内部消息包括车内总线通信消息。
8.8.2　车辆应对接收的消息进行真实性和完整性校验，以识别恶意的V2X消息、恶意的诊断消息、恶意的专有消息等，并采取防护措施，防止车辆受到恶意消息的攻击。
注1：	V2X消息如道路设施发送到车辆的消息、车辆与车辆之间的消息（例如CAM, DENM）。
注2：	专有消息指正常发送自OEM或组件/系统/功能供应商的消息。

9　软件升级安全要求（与软件升级标准格式同步，调整为：在线、离线，共性要求和增强型要求）
9.1　在线升级安全要求
9.1.1　车辆端和OTA软件升级服务器应进行身份认证，至少通过数字证书等方式，验证彼此身份的真实性。
注：常见的认证方式包括使用数字证书进行身份认证等。
9.1.2　车辆端应对升级包进行真实性和完整性校验。
9.1.3　车辆端软件升级程序应将OTA软件升级流程中发生的失败事件进行日志记录。
注1：	失败事件包括升级包校验失败、与升级包服务器身份认证失败等。
注2：	日志记录内容包括事件时间、事件类型等。
9.1.4　车辆端软件升级Msater升级程序应具备安全启动的功能，可信根、Bootloader程序及系统固件不应被篡改，或被篡改后无法正常启动。
9.2　离线升级安全要求
9.2.1　车辆端应对刷写接入端进行身份认证，验证其身份的真实性。
注：常见的认证方式包括使用数字证书进行身份认证。
9.2.2　车辆端应对升级包完整性进行校验。
9.3　车载软件升级系统在获取升级包后应对其进行真实性和完整性校验。
9.4　软件升级系统不存在由权威漏洞平台6个月前公布且未经处置的高危及以上的安全漏洞。
>10.1　防提取要求
10.1.1　车辆系统应采取反提取版权或专有软件(产品盗版/被盗软件)加固防御机制。
注1：	反提取版权或专有软件(产品盗版/被盗软件)清单由企业评估后提出。
注2：	防御机制可采用安全访问控制和其他相关的设计保护机制。
10.1.2　应加密存储个人敏感信息，并防止被非授权访问和获取。
10.1.3　车辆应安全存储加密密钥，防止其被非授权访问和获取。
注：常见的安全存储方式包括存储在TEE、SE、HSM等安全模块，也包括安全的软件存储形式。
10.2　防篡改要求
10.2.1　应保证存储在车内的车辆唯一标识数据、用于身份识别的数据不被篡改。
注：常见的防篡改技术措施包括对访问者进行身份鉴别和权限控制等，也可使用只读等技术措施保证数据不被篡改。
10.2.2　应保证存储在车内的重要数据不被篡改。
10.3　应安全存储系统日志文件，防止其被未授权删除和修改。
注：系统日志文件包括监管日志、数据操作日志、安全日志等。
10.4　车辆应采取限制措施，防止安装或运行带有恶意行为的软件。
注：常见的限制措施包括白名单机制、黑名单机制等，包括只允许通过企业许可的应用商店下载应用、通过特定的移动存储设备安装软件、仅能通过OTA的方式安装和更新软件等。
10.5　车辆应具备监测或记录拒绝服务攻击的能力。
10.6　车辆应安全存储车辆配置相关参数，防止其被未授权删除和修改。整合相同要求
注1：常见的车辆配置相关参数包括制动数据、安全气囊展开阈值、电池参数、自动驾驶参数等。
注2：常见的防止未授权删除和修改技术措施包括对访问者进行身份鉴别和权限控制，也可使用只读等技术措施保证车辆配置相关参数不被未授权删除和修改。
10.7　应采取必要的措施减少软件缺陷。
10.8　车辆转售、租借或报废时，应具备个人信息清除功能及防恢复机制。


A.6　软件升级安全测试方法
A.6.1　OTA升级安全测试方法
A.6.1.4　关键零部件安全启动功能检验测试方法
测试人员应依据软件升级相关的车辆端关键零部件清单，按照如下方法检验测试车辆是否满足正文9.1.4的要求：
a）获取安全启动信任根存储区域的访问方法和地址，使用软件调试工具写入数据，重复多次检查是否可将数据写入该存储区域；
b)获取正常运行的Bootloader程序，使用软件调试工具修改该Bootloader程序的签名信息，将修改后的Bootloader程序写入到指定区域，检查是否正常加载Bootloader；
c)获取操作系统签名，使用软件调试工具对签名进行篡改，将修改后签名写入到的指定可信区域内，检查是否正常工作；
d)获取升级程序的系统固件，使用软件调试工具对其进行篡改，将修改后的系统固件写入到指定区域，检查升级程序是否正常工作。

> A.7 数据代码安全测试方法
> A.7.1 数据代码防提取测试方法
> A.7.1.1 版权或专有软件防提取测试方法
> 测试人员应依据测试车辆的版权或专有软件清单和加固方式，选择以下两种方法中的一种，检验测试车辆是否满足正文11.1.1的要求：
> a）若采取访问控制保护版权或专有软件，按照访问控制规则创建一个未添加访问控制权限的用户，尝试从车载信息交互系统、自动驾驶域控制器等部件中提取版权软件或专有软件，检测是否可以非法提取版权或专有软件。
> b）若采取其他保护机制保护版权或专有软件，尝试绕过企业提供的保护机制，从车载信息交互系统、自动驾驶域控制器等部件中提取版权软件或专有软件，检测是否可以非法提取版权或专有软件。
>
> A.7.1.3　秘钥防泄露测试方法
> 测试人员应按照测试车辆秘钥的存储方式，选择以下两种方法中适用的一种，检验测试车辆是否满足正文11.1.3的要求：
> a)若采取HSM等硬件安全模块存储秘钥，应依据硬件安全模块安装位置，核查车辆是否安装了硬件安全模块来保护秘钥。
> b)若采取安全的软件存储形式存储秘钥，应依据秘钥存储区域和地址范围说明，尝试使用软件分析工具提取秘钥，检测是否可以被非授权提取或是否加密存储。


A.7.5　车辆拒绝服务攻击防护测试方法
测试人员应依据车辆通信链路的形式，从A.6.5.1和A.6.5.2中选择合适的测试方法检验测试车辆是否满足11.5的要求：
A.7.5.1　CAN总线拒绝服务攻击防护测试方法
将拒绝服务攻击测试设备接入车辆的各路CAN总线，识别总线波特率，尝试向总线发起拒绝服务攻击数据，并在攻击结束后，核查车辆是否监测并记录了该次拒绝服务攻击；
A.7.5.2　以太网拒绝服务攻击防护测试发
将拒绝服务攻击测试设备与车辆的车载以太网进行组网，并尝试向车载以太网发起拒绝服务攻击，并在攻击结束后，核查车辆是否监测并记录了该次拒绝服务攻击。
A.7.6　关键配置参数防篡改测试方法
测试人员应依据测试车辆关键配置参数清单，按照如下方法检验测试车辆是否满足正文11.6的要求：
依据车辆关键配置参数存储区域和地址范围说明，尝试使用软件分析工具篡改车辆关键配置参数，检测是否可以被篡改。



## 芯片
##