# OTA

远程升级（Over The Air，OTA）是通过移动通信的空中接口实现对移动终端设备进行远程管理的技术。汽车OTA通常由汽车生产厂商发起，基本实施流程包括：
- 云端的升级包部署
- 云端与车端的安全连接建立
- 云端到车端的升级包推送与安全传输
- 车内的升级包拆包、分发与执行

在网联化和软件定义汽车两大趋势下，汽车OTA（远程升级）受到汽车业界越来越多的重视。据调研报告，多达383.8万汽车支持不同程度的汽车OTA（远程升级）。OTA（远程升级）的先锋是特斯拉，在2020年总共发送了137次升级，涉及影音娱乐，个性化定制，自动辅助变道等方面。目前汽车OTA（远程升级）主要挑战是稳定的通信性能和网络安全。

《节能与新能源汽车技术路线图2.0》预计到2025年，我国部分自动驾驶、有条件自动驾驶智能网联汽车的销量占当年汽车总销量的比例超过50%，高度自动驾驶智能网联汽车开始进入市场，C-V2X终端新车装配率达50%。随着汽车智能化、网联化技术快速发展，OTA技术作为汽车产品软件更新的主要手段，将成为智能网联车标配。OTA技术可以持续为用户提供新功能，优化车辆性能，获得全新体验，越来越受到整车企业和大众消费者的关注。但是在升级过程中，OTA云端、车端、升级包等关键环节均存在攻击和篡改等安全隐患。一旦出现安全问题，可能导致车辆运行异常、隐私泄露、财务损失、人身伤亡等风险。因此，保障OTA升级的安全尤为重要和紧迫。
## 合规要求
2020年11月23日，市场监管总局办公厅出台《关于进一步加强汽车远程升级（OTA）技术召回监管的通知》。自通知印发之日起，生产者（含在中国境内依法设立的生产汽车产品并以其名义颁发产品合格证的企业，以及从中国境外进口汽车产品到境内销售的企业）采用OTA方式对已售车辆开展技术服务活动的，应按照《条例》及《实施办法》要求，向市场监管总局质量发展局备案。生产者采用OTA方式消除汽车产品缺陷、实施召回的，应按照《条例》及《实施办法》要求，制定召回计划，向市场监管总局质量发展局备案，依法履行召回主体责任。

OTA 的信息安全要求
UNECE ECE/TRANS/WP.29/GRVA/2019/3 草稿版[1] 第5章规定了 OTA 相关的网络安全要求。

>5.4. Security requirement for updates
5.4.1. The vehicle manufacturer shall be able to demonstrate to the authority that their software update process will ensure, according to the state of the art, that:
(a) the software updates will be protected to prevent manipulation before the update process is initiated (i.e. ensure that only authorized, uncorrupted updates are sent to the vehicle);
(b) the update processes used are protected to prevent them being compromised, including development of the system update program or firmware;
(c) the authenticity and integrity of the software updates will be protected to prevent their compromise and prevent invalid updates.

中文意思是

车辆制造商应能够向管理局证明，其软件更新过程将根据行业技术水平确保：
（a）软件更新包将受到保护，以防止在启动更新过程之前被篡改（即确保仅向车辆发送授权的、未损坏的更新）；
（b）所使用的更新过程受到保护，以防止它们受到损害，包括系统更新程序或固件的开发过程；
（c）软件更新包的真实性和完整性将受到保护，以防止其损害，并防止无效的更新。

其中一个比较模糊的要求就是汽车厂商需要根据行业技术水平来实现（a）、（b）和（c）中的要求，而行业技术水平是一直在变化的。
无线刷新过程涉及的节点从上至下可能会有

服务器后台服务器
汽车和后台的链接
汽车
汽车内部通信网络
被更新的ECU
OTA涉及的所有节点都有可能被黑客攻击，为了降低被黑客攻破的可能性，在每一层都应该做防护。



## 测试

### 中国汽研
作为行业第三方机构，中国汽研北京分院积极布局OTA安全测评能力，依托与国家互联网应急中心共同成立的车联网安全实验室，联合国内主要OTA产品提供商以及安全厂商等行业资源，主要支撑了TC463中《基于远程升级技术的汽车产品召回实施要求》标准草案编写，并且联合中国标准化研究院等单位，先后承担了《智能网联汽车安全检测平台》、《智能网联汽车车载安全网关》等4项国家课题研究，目前具备先进的OTA测试设备，以及数千条专项的测试用例，现已形成面向汽车产品OTA安全评估解决方案。

本解决方案面向台架测试、实车测试、软件测试等多维测试环境，包含通用业务安全功能、OTA云平台、OTA车端和OTA升级包四大模块，共计58项测试服务内容，提供全面性、系统性、专业性服务，为企业OTA升级全流程保驾护航。

汽车OTA安全测试：
- 通用业务安全功能（20项）
  - 软件下载
  - 软件升级
  - 升级条件检查
  - 升级过程监督
  - 升级失败处理
- 升级车辆安全测试（20项）
  - 硬件安全
  - 数据安全
  - 通信安全
  - 系统安全
  - 安全异常防护
  - 功能安全保护
  - 鲁棒性测评
- 软件升级包安全测评（10项）
  - 漏洞测评
  - 防护性测评
  - 功能安全验证
- 云端安全测评（8项）
  - 云端业务流程
  - 云端系统安全
  - 云端稳定性

### 罗德与施瓦茨
作为汽车通信测试技术的领导者，罗德与施瓦茨（简称“R&S”公司）针对主机厂对汽车OTA（远程升级）通信性能的测试需求，提出了汽车OTA（远程升级）下载流量测试方案：

#### 方案一：OTA（远程升级）下载流量测试方案
<img src="images/OTA安全/R&S方案一OTA下载流量测试方案.jpg">
这套方案核心设备是CMW/CMX500 网络模拟器。CMW/CMX500提供了理想的移动通信环境，既可以测试基本的通话功能，也可以测试汽车应用或T-box通信性能和诊断汽车到车企用户服务器链路等问题，详细功能列举如下:

- 汽车上传下载网速测试和IP数据统计，比如汽车T-box在4G或5G网络下一定时间内的数据吞吐量测试，统计IP网络的时延，丢包等；

- 提供基于IP的理想测试环境供客户定制测试内容，比如汽车应用通过CMW/CMX500网络模拟器连接第三方服务网站如爱奇艺，用户手机APP通过CMW/CMX500访问汽车等；

- IP数据分析和设置不同服务等级（QoS），比如分析每个IP连接，应用，协议所产生的数据流量的行为和占比，可以设置不同IP服务优先级（网络时延，抖动和丢包等级）进行测试。

(注意此测试需要改写汽车芯片的esim信息，改成兼容CMW/CMX500的加密和鉴权参数。)

汽车用户投诉应用下载问题基本发生在实际网络环境下，所以为了节省在道路上外网环境下解决客户投诉问题的时间和费用，主机厂还想要在研发实验室复现用户在道路上实际网络遇到的问题。

#### 在方案一基础上，R&S公司又提出了Road to Lab测试方案

该方案的架构和功能如下：
<img src="images/OTA安全/R&S方案二roadtolab测试方案.jpg">

方案二主要包括外场移动网络扫频软件“Romes”，扫频仪和图形化外场网络信号复现编辑软件”CM360°“，最后通过生成的测试脚本将外场网络信号导入CMW/CMX500网络模拟器中进行测试。通过外场路测采集客户投诉较多地方的网络信号(包括小区参数SIB系统消息，L3层信令消息信令流程，小区信号强度动态变化)生成log并在实验室复现分析，集中定位问题和解决客户的投诉。

<img src="images/OTA安全/CM360度外场网络复现步骤和网络参数报告.jpg">

测试方案二已能够帮助车企解决汽车互联网应用在外场实际网络中的网络性能相关的问题和投诉。


### 为辰信安

网络安全是汽车OTA（远程升级）的核心要素。随着欧盟WP29 R156号法规软件升级及软件升级管理体系（SUMS）和国内相关的监管法规的陆续推出，汽车行业对OTA（远程升级）的信息安全满足法规测试的需求越来越迫切。

OTA（远程升级）由“云”（业务平台）、“管”（通信通道）、“端”（车辆端设备）组成，存在非常多的外部可攻击点，安全隐患问题突出。为辰信安是国内领先的汽车网络安全技术与服务提供商，针对主机厂OTA信息安全测试的需求，提供OTA（远程升级）的信息安全测试系统架构如下图所示：

<img src="images/OTA安全/为辰信安OTA远程升级信息安全测试系统架构.jpg">

OTA（远程升级）信息安全测试系统具有如下特点：
- 测试过程记录清晰、统计全面准确。测试过程自动化程度高，降低对检测人员的专业背景需求，自动分析检测结果并生成报告；
- 与CMW/CMX500深度融合。支持对CMW/CMX500、示波器等设备的程控管理，实现测试过程的自动执行以及结果数据的自动回收处理；
- 同步国际权威特征库，时效性强。以国际漏洞库CVE为基础，结合OTA（远程升级）最佳实践，并持续收集和完善特征库；
- 提供可定制化服务。提供开放的SDK，支持系统功能的灵活扩展。

<img src="images/OTA安全/OTA信息安全测试内容.jpg">

OTA（远程升级）的信息安全测试内容，根据测试对象可分为云、管、端等几个方面。



