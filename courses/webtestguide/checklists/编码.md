# 编码

## 字符编码转换查询
- https://unicode-table.com/cn/search/?q=%C5%BF
- [qqxiuzi HTML字符实体转换](https://www.qqxiuzi.cn/bianma/zifushiti.php)
- [bejson  url 编码](http://www.bejson.com/enc/urlencode/)

### 小技巧
#### html实体编码序列转为html明文
将类似 `&#x6a;&#x61;&#x76;&#x61;` 的实体编码放在一个 html 文件中，使用浏览器打开，可以看明文

#### url编码查看

打开浏览器开发工具-控制台，将类似 %5c%75%30%30%36%31%5c 的url编码用decodeURI或decodeURIComponent函数解析

例如：
```
decodeURI("%5c%75%30%30%36%31%5c%75%30%30%36%63%5c%75%30%30%36%35%5c%75%30%30%37%32%5c%75%30%30%37%34")
"\u0061\u006c\u0065\u0072\u0074")

得到unicode（JavaScript 编码）：
"\u0061\u006c\u0065\u0072\u0074"

在将此编码输入到控制台命令行中，即
"\u0061\u006c\u0065\u0072\u0074"

可得："alert"
```

#### unicode 解码 
将此编码输入到控制台命令行中，即
"\u0061\u006c\u0065\u0072\u0074"

可得："alert"


## 基础

Web应用中常见的字符编码有：

- URL编码
- Unicode编码
- HTML 编码
- Base64 编码
- 16进制编码

### URL编码

URL只允许使用US-ASCII字符集中的可打印字符，即ASCII码中的0x20~0x7e内的字符，而且其中一些字符在HTTP协议或URL标准中有特殊含义，所以0x20~0x7e内的也不是全部可用于URL。

URL编码遵循下列规则： 

- 每对name/value由&；符分开；
- 每对来自表单的name/value由=符分开。
- 如果用户没有输入值给这个name，那么这个name还是出现，只是无值。
- 任何特殊的字符（非七位ASCII，如汉字）将以百分符%用十六进制编码，包括象 =  & ；，和 % 这些特殊的字符。

url编码就是一个字符ascii码的十六进制，然后在前面加上“%”。比如“\”，它的ascii码是92，92的十六进制是5c，所以“\”的url编码就是%5c。那么汉字的url编码呢？很简单，看例子：“胡”的ascii码是-17670，十六进制是BAFA，url编码是“%BA%FA”。

#### URL编码方案

功能：对扩展ASCII码中的任何有问题字符进行编码，使其可以通过HTTP安全传输。

- 任何URL编码的字符都以 % 为前缀；
- 其后是这个字符的两位16进制ASCII代码。

例如：
- %3d 表示 =
- %25 表示 %
- %20 表示 空格
- %0a 表示 新行
- %00 表示 空字节
- 加号+ 表示URL编码的空格

**注意：如果在渗透过程中，需要将下列字符当作数据插入HTTP请求，就必须将它们进行URL编码：**
> 空格 % ？ & = ; + # 


###  Unicode编码

Unicode编码是一种为支持全球使用的各种文字编码而设计的一种字符编码标准。

Unicode是国际组织制定的可以容纳世界上所有文字和符号的字符编码方案。目前的Unicode字符分为17组编排，0x0000 至 0x10FFFF，每组称为平面（Plane），而每平面拥有65536个码位，共1114112个。然而目前只用了少数平面。UTF-8、UTF-16、UTF-32都是将数字转换到程序数据的编码方案。

16位的Unicode编码原理于URL编码类似，为了通过HTTP进行传输，16位Unicode编码的字符以 %u 为前缀，其后是这个字符的16进制Unicode码点。

例如：
- %u2215 表示 /
- 中文范围 4E00-9FA5
  
#### UTF-8

UTF-8是一种长度可变的编码标准，它使用1个或几个字节表示每个字符。UTF-8的特点是对不同范围的字符使用不同长度的编码。对于0x00-0x7F之间的字符，UTF-8编码与ASCII编码完全相同。UTF-8编码的最大长度是4个字节。

|Unicode编码(十六进制)　|UTF-8 字节流(二进制)|
|-|-|
|000000-00007F|0xxxxxxx|
|000080-0007FF|110xxxxx 10xxxxxx|
|000800-00FFFF|1110xxxx 10xxxxxx 10xxxxxx|
|010000-10FFFF|	11110xxx10xxxxxx10xxxxxx10xxxxxx|

为通过http传输，UTF-8编码的多字节字符以%为前缀，其后用16进制表示每个字节。

**攻击Web应用程序时，之所以要用到Unicode编码，主要在于有时可以用它来破坏输入确认机制（输入检查）。如果输入过滤阻止了某些恶意表达式，但随后处理输入的组件识别Unicode编码，就可以使用各种标准于畸形Unicod编码避开过滤。**


#### javascript 编码
采用unicode编码

例如：
- `/` 是 `\u0338`
- `‹`	HTML	JS	CSS 分别为：`&#139	\u008B	\008B`	
- `›`	HTML	JS	CSS 分别为：`&#155	\u009B	\009B`
- `“`	HTML	JS	CSS 分别为：`&#8220	\u201C	\201C`
- `”`	HTML	JS	CSS 分别为：`&#8221	\u201D	\201D`
- `‘`	HTML	JS	CSS 分别为：`&#8216	\u2018	\2018`	
- `’`	HTML	JS	CSS 分别为：`&#8217	\u2019	\2019`

### HTML 编码

HTML编码是一种用于表示问题字符，使其能安全并入HTML文档的方案。

有许多字符有特殊含义（HTML元字符），用于定义文档结构，而非文本。为了让这些字符能与文本内容共存，就需要将他们编码。

例如：
```
&quot; 表示 "
&apos; 表示 '
&amp; 表示 &
&lt; 表示 <
&gt; 表示 >
```
此外，任何字符都可以使用它的十进制ASCII码进行HTML编码，例如：
```
&#34; 表示 "
&#39; 表示 '
```
或者使用16进制的ASCII码（以x为前缀），例如：
```
&#x22; 表示 "
&#x27; 表示 '
```
**当攻击Web应用时，HTML编码主要在探查跨站脚本（XXS)时发挥作用。如果应用程序在响应中返回未被修改的用户输入，那么它可能容易被攻击；通常对一些危险（特殊含义）字符进行HTML编码会加强安全性。**

#### HtmlEncode 函数

功能：将字符转换为Html实体，对应标准为ISO-8859-1.

例如：
```
" 转变为 &quot;
' 转变为 &apos; 或 &#x27;
& 转变为 &amp; 
< 转变为 &lt; 
> 转变为 &gt; 
/ 转变为 &#x2F;

```

PHP中这个函数为：`htmlentities() ` 和 `htmlspecialchars()`

### HTML 字符实体

在 HTML 中，某些字符是预留的。 
在 HTML 中不能使用小于号（<）和大于号（>），这是因为浏览器会误认为它们是标签。 
如果希望正确地显示预留字符，我们必须在 HTML 源代码中使用字符实体（character entities）。比如要写这篇日志在前端展现出大于号（>），小于号（<）等就必须在后台数据库中把这些对象保存成字符实体的形式。 
字符实体类似这样：
&entity_name;
或者 
&#entity_number;
如需显示小于号，我们必须这样写：&lt; 或 &#60; 
提示：使用实体名而不是数字的好处是，名称易于记忆。不过坏处是，浏览器也许并不支持所有实体名称（对实体数字的支持却很好）。 

不间断空格（non-breaking space） 
HTML 中的常用字符实体是不间断空格( )。 
浏览器总是会截短 HTML 页面中的空格。如果您在文本中写 10 个空格，在显示该页面之前，浏览器会删除它们中的 9 个。如需在页面中增加空格的数量，您需要使用 &nbsp; 字符实体。 
HTML中有用的字符实体 
注释：实体名称对大小写敏感！ 

|显示结果|描述|实体名称|实体编号|
|-|-|-|-| 
| |空格|`&nbsp;`|`&#160;`|
|<|小于号|`&lt;`|`&#60;`|
|>|大于号|`&gt;`|`&#62;`|
|&|和号|`&amp;`|`&#38;`|
|"|引号|`&quot;`|`&#34;`|
|'|撇号 |`&apos;` (IE不支持)|`&#39;`|
|￠|分|`&cent;`|`&#162;`|
|&pound;|镑|`&pound;`|`&#163;`|
|&yen;|日圆|`&yen;`|`&#165;`|
|&euro;|欧元|`&euro;`|
|: |冒号| `&#x3A;` 或 `&#58;`|
### Javascript编码

`JavascriptEncode` 需要使用“\”对特殊字符转义。

为了对抗xss，输出的变量必须在引号内。例如有两种写法：
- 第一种：`var x=escapeJavascript($evil);`
- 第二种：`var y='"'+escapeJavascript(#evil);`

如果用户自定义的escapeJavascript函数只转义了几个危险字符，例如`' " < > \ & #`那么上面的两行代码输出后就会变成：
- var x = 1;alert(2); 不安全
- var y = "1;alert(2)"; 安全

所以需要对数字、字母之外的所有字符都以十六进制`\xHH`的方式进行编码。

#### 严格的JavaScript编码



### Base64 编码

Base64编码将任何二进制数据转换为ASCII字符。它常用于：
- 对电子邮件进行编码，使其通过SMTP安全传输。
- 在HTTP Basic Auth中对用户/密码进行编码。
- 其它仅允许ASCII码通过的检查机制。

Base64编码将输入数据转换成3个字节块。每个块被划分为4段，每段6个数据位。这6位二进制有64种排列组合可能，所以可用一组64个不同的ASCII字符进行替换表示。

<img src="images/webcyber/base64转换过程.jpg" width="480" alt="base64转换过程" />

Base64字符集中包含的字符有： A-Z a-z 0-9 + /

如果，最后的输入数据块不够3个字节，就用一个或两个=号来补足。

**许多Web应用利用Base64编码在cookie、其它参数中传送二进制数据，甚至用于打乱敏感数据以防止修改。**

请注意任何发送到客户端的Base64数据。


### 十六进制编码

许多Web应用在传送二进制数据时，直接使用16进制编码，用ASCII字符表示16进制数据块。

例如，在cookie中的用户名daf进行16进制编码：646166

和Base64编码类似，16进制编码的数据也容易辨认。

## UNICODE 

代码 显示 描述 
U+0020  空格 
U+0021 ! 叹号 
U+0022 " 双引号 
U+0023 # 井号 
U+0024 $ 价钱／货币符号 
U+0025 % 百分比符号 
U+0026 & 英文“and”的简写符号 
U+0027 ' 引号 
U+0028 ( 开 圆括号 
U+0029 ) 关 圆括号 
U+002A * 星号 
U+002B + 加号 
U+002C , 逗号 
U+002D - 连字号／减号 
U+002E . 句号 
U+002F / 由右上至左下的斜线 
U+0030 0 数字 0 
U+0031 1 数字 1 
U+0032 2 数字 2 
U+0033 3 数字 3 
U+0034 4 数字 4 
U+0035 5 数字 5 
U+0036 6 数字 6 
U+0037 7 数字 7 
U+0038 8 数字 8 
U+0039 9 数字 9 
U+003A : 冒号 
U+003B ; 分号 
U+003C < 小于符号 
U+003D = 等于号 
U+003E > 大于符号 
U+003F ? 问号 
U+0040 @ 英文“at”的简写符号 
U+0041 A 拉丁字母 A 
U+0042 B 拉丁字母 B 
U+0043 C 拉丁字母 C 
U+0044 D 拉丁字母 D 
U+0045 E 拉丁字母 E 
U+0046 F 拉丁字母 F 
U+0047 G 拉丁字母 G 
U+0048 H 拉丁字母 H 
U+0049 I 拉丁字母 I 
U+004A J 拉丁字母 J 
U+004B K 拉丁字母 K 
U+004C L 拉丁字母 L 
U+004D M 拉丁字母 M 
U+004E N 拉丁字母 N 
U+004F O 拉丁字母 O 
U+0050 P 拉丁字母 P 
U+0051 Q 拉丁字母 Q 
U+0052 R 拉丁字母 R 
U+0053 S 拉丁字母 S 
U+0054 T 拉丁字母 T 
U+0055 U 拉丁字母 U 
U+0056 V 拉丁字母 V 
U+0057 W 拉丁字母 W 
U+0058 X 拉丁字母 X 
U+0059 Y 拉丁字母 Y 
U+005A Z 拉丁字母 Z 
U+005B [ 开 方括号 
U+005C / 由左上至右下的斜线 
U+005D ] 关 方括号 
U+005E ^ 抑扬（重音）符号 
U+005F _ 底线 
U+0060 ` 重音符 
U+0061 a 拉丁字母 a 
U+0062 b 拉丁字母 b 
U+0063 c 拉丁字母 c 
U+0064 d 拉丁字母 d 
U+0065 e 拉丁字母 e 
U+0066 f 拉丁字母 f 
U+0067 g 拉丁字母 g 
U+0068 h 拉丁字母 h 
U+0069 i 拉丁字母 i 
U+006A j 拉丁字母 j 
U+006B k 拉丁字母 k 
U+006C l 拉丁字母 l（L的小写） 
U+006D m 拉丁字母 m 
U+006E n 拉丁字母 n 
U+006F o 拉丁字母 o 
U+0070 p 拉丁字母 p 
U+0071 q 拉丁字母 q 
U+0072 r 拉丁字母 r 
U+0073 s 拉丁字母 s 
U+0074 t 拉丁字母 t 
U+0075 u 拉丁字母 u 
U+0076 v 拉丁字母 v 
U+0077 w 拉丁字母 w 
U+0078 x 拉丁字母 x 
U+0079 y 拉丁字母 y 
U+007A z 拉丁字母 z 
U+007B { 开 卷曲括号 
U+007C | 直棒 
U+007D } 关 卷曲括号 
U+007E ~ 波浪纹


拉丁字母-1
 
代码 显示 描述 
U+00A1 ? 倒转的叹号 
U+00A2 ? （货币单位）分钱、毫子 
U+00A3 ? （货币）英镑 
U+00A4 ¤ （货币）当货币未有符号时以此替代 
U+00A5 ? （货币）日圆 
U+00A6 ? 两条断开的直线 
U+00A7 § 文件分不同部分 
U+00A8 ¨ （语言）分音 
U+00A9 ? 版权符 
U+00AA ? （意大利文、葡萄牙文、西班牙文）阴性序数 
U+00AB ? 双重角形引号 
U+00AC ? 逻辑非 
U+00AE ?? 商标 
U+00AF ? 长音 
U+00B0 ° 角度 
U+00B1 ± 正负号 
U+00B2 ? 二次方 
U+00B3 ? 三次方 
U+00B4 ? 锐音符 
U+00B5 ? 百万分之一，10?6 
U+00B6 ? 文章分段 
U+00B7 · 间隔号 
U+00B8 ? 软音符 
U+00B9 ? 一次方 
U+00BA ? （意大利文、葡萄牙文、西班牙文）阳性序数 
U+00BB ? 指向右的双箭头 
U+00BC ? 四分之一 
U+00BD ? 二分之一 
U+00BE ? 四分之三 
U+00BF ? 倒转的问号 
U+00C1 ? 在拉丁字母 A 上加重音符 
U+00C2 ? 在拉丁字母 A 上加抑扬符“^” 
U+00C3 ? 在拉丁字母 A 上加“~” 
U+00C4 ? 在拉丁字母 A 上加分音符“..” 
U+00C5 ? 在拉丁字母 A 上加角度符“°” 
U+00C6 ? 拉丁字母 A、E 的混合 
U+00C7 ? 在拉丁字母 C 下加软音符 
U+00C8 ? 在拉丁字母 E 上加重音符 
U+00C9 ? 在拉丁字母 E 上加锐音符 
U+00CA ? 在拉丁字母 E 上加抑扬符 
U+00CB ? 在拉丁字母 E 上加分音符 
U+00CC ? 在拉丁字母 I 上加重音符 
U+00CD ? 在拉丁字母 I 上加锐音符 
U+00CE ? 在拉丁字母 I 上加抑扬符 
U+00CF ? 在拉丁字母 I 上加分音符 
U+00D0 ? 古拉丁字母 ?，现只有法罗文和冰岛文使用 
U+00D1 ? 在拉丁字母 N 上加波浪纹“~” 
U+00D2 ? 在拉丁字母 O 上加锐音符 
U+00D3 ? 在拉丁字母 O 上加重音符 
U+00D4 ? 在拉丁字母 O 上加抑扬符 
U+00D5 ? 在拉丁字母 O 上加波浪纹“~” 
U+00D6 ? 在拉丁字母 O 上加分音符 
U+00D7 × 乘号，亦可拖按“Alt”键，同时按“41425”五键 
U+00D8 ? 在拉丁字母 O 由右上至左下加对角斜线“/” 
U+00D9 ? 在拉丁字母 U 上加重音符 
U+00DA ? 在拉丁字母 U 上加锐音符 
U+00DB ? 在拉丁字母 U 上加抑扬符 
U+00DC ? 在拉丁字母 U 上加分音符 
U+00DD ? 在拉丁字母 Y 上加锐音符 
U+00DE ? 古拉丁字母 ?，现已被“Th”取替 
U+00DF ? 德文字母 ? 
U+00E0 à 在拉丁字母 a 上加重音符 
U+00E1 á 在拉丁字母 a 上加锐音符 
U+00E2 ? 在拉丁字母 a 上加抑扬符 
U+00E3 ? 在拉丁字母 a 上加波浪纹“~” 
U+00E4 ? 在拉丁字母 a 上加分音符 
U+00E5 ? 在拉丁字母 a 上加角度符“°” 
U+00E6 ? 拉丁字母 a、e 的混合 
U+00E7 ? 在拉丁字母 c 上加软音符 
U+00E8 è 在拉丁字母 e 上加锐音符 
U+00E9 é 在拉丁字母 e 上加重音符 
U+00EA ê 在拉丁字母 e 上加抑扬符 
U+00EB ? 在拉丁字母 e 上加分音符 
U+00EC ì 在拉丁字母 i 上加重音符 
U+00ED í 在拉丁字母 i 上加锐音符 
U+00EE ? 在拉丁字母 i 上加抑扬符 
U+00EF ? 在拉丁字母 i 上加分音符 
U+00F0 ? 古拉丁字母 ?的小写 
U+00F1 ? 在拉丁字母 n 上加波浪纹“~” 
U+00F2 ò 在拉丁字母 o 上加重音符 
U+00F3 ó 在拉丁字母 o 上加锐音符 
U+00F4 ? 在拉丁字母 o 上加抑扬符 
U+00F5 ? 在拉丁字母 o 上加波浪纹“~” 
U+00F6 ? 在拉丁字母 o 上加分音符 
U+00F7 ÷ 除号，亦可拖按“Alt”键，同时按“41426”五键 
U+00F8 ? 在拉丁字母 o 由右上至左下加对角斜线“/” 
U+00F9 ù 在拉丁字母 u 上加重音符 
U+00FA ú 在拉丁字母 u 上加锐音符 
U+00FB ? 在拉丁字母 u 上加抑扬符 
U+00FC ü 在拉丁字母 u 上加分音符 
U+00FD ? 在拉丁字母 u 上加锐音符 
U+00FE ? 古拉丁字母 ?，现已被“th”取替 
U+00FF ? 在拉丁字母 u 上加分音符


拉丁字母（扩展 A）
 
代码 显示 描述 
U+0100 ? 在拉丁字母 A 上加长音符 
U+0101 ā 在拉丁字母 a 上加长音符 
U+0102 ? 在拉丁字母 A 上加短音符 
U+0103 ? 在拉丁字母 a 上加短音符 
U+0104 ? 在拉丁字母 A 上加反尾形符 
U+0105 ? 在拉丁字母 a 上加反尾形符


拉丁字母（扩展 C）
 
代码 显示 描述 
U+2C60 ? 在拉丁字母“L”中间加两条横线“=” 
U+2C61 ? 在拉丁字母“l”（L 的小写）中间加一条横线“-” 
U+2C62 ? 在拉丁字母“L”（大写）中间加一条波浪线“~” 
U+2C63 ? 在拉丁字母“P”中间加一条横线“-” 
U+2C64 ? 在拉丁字母“R”下加一条尾巴 
U+2C65 ? 在拉丁字母“a”上加一条对角斜线“/” 
U+2C66 ? 在拉丁字母“t”上加一条对角斜线“/” 
U+2C67 ? 在拉丁字母“H”下加一条尾巴 
U+2C68 ? 在拉丁字母“h”下加一条尾巴 
U+2C69 ? 在拉丁字母“K”下加一条尾巴 
U+2C6A ? 在拉丁字母“k”下加一条尾巴 
U+2C6B ? 在拉丁字母“Z”下加一条尾巴 
U+2C6C ? 在拉丁字母“z”下加一条尾巴 
U+2C74 ? 在拉丁字母“v”的起笔加一个弯勾 
U+2C75 ? 拉丁字母“H”的左半部 
U+2C76 ? 拉丁字母“h”的左半部 
U+2C77 ? 希腊字母“φ”的上半部


彝文字母
 
拉丁字母（扩展 D）
 
代码 显示 描述 
U+A720 ? 强调音调音昂的改造字母 
U+A721 ? 强调音调低沉的改造字母


特殊
 
代码 显示 描述 
U+FFFC   取代无法显示字符的“OBJ” 
U+FFFD ? 无法显示的字符以它取代


CR LF:回车符 + 换行符，Unicode 字符 000D + 000A
LF：换行符，Unicode 字符 000A
NEL：下一行，Unicode 字符 0085
LS：行分隔符，Unicode 字符 2028
PS：段落分隔符，Unicode 字符 2029

使用时注意加上\u,即`\u2028` 