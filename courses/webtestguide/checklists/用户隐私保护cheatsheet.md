# 用户隐私保护手册

## 介绍

这份OWASP备忘单介绍了Web开发人员可以使用的缓解方法，以保护其用户免受各种可能威胁到其隐私和匿名性的潜在威胁和侵害。本备忘单着重于用户使用在线服务时可能会面临的隐私和匿名威胁，尤其是在诸如社交网络和通信平台的情况下。

## 准则

### 强密码学

任何处理用户身份，私人信息或通信内容的在线平台都必须使用强加密技术来确保安全。用户通信在传输和存储中必须经过加密。还必须使用具有增强 work factor 的哈希算法来保护诸如密码之类的用户机密，以便极大地降低暴露凭证和适当完整性控制的风险。

为了保护传输中的数据，开发人员必须使用并遵守TLS / SSL最佳做法。例如，经过验证的证书，受到充分保护的私钥，仅使用强密码，向用户提供信息性和明确的警告以及足够的密钥长度。必须使用足够长度的密钥并在严格的访问条件下（技术和管理上）使用存储密钥对私有数据进行加密。无论用户凭据是否在存储中加密，都必须对其进行哈希处理。

有关强密码和最佳实践的详细指南，请阅读以下OWASP参考：

- Cryptographic Storage Cheat Sheet.
- Authentication Cheat Sheet.
- Transport Layer Protection Cheat Sheet.
- [Guide to Cryptography.](https://wiki.owasp.org/index.php/Guide_to_Cryptography)
- [Testing for TLS/SSL](https://owasp.org/www-project-web-security-testing-guide/stable/4-Web_Application_Security_Testing/09-Testing_for_Weak_Cryptography/01-Testing_for_Weak_SSL_TLS_Ciphers_Insufficient_Transport_Layer_Protection.html).

### 支持HTTP严格传输安全性

HTTP严格传输安全性（HSTS）是服务器设置的HTTP标头，向用户代理指示仅接受安全（HTTPS）连接，提示用户代理将所有不安全的HTTP链接更改为HTTPS，并强制兼容的用户代理执行以下操作：通过拒绝用户不信任的任何TLS / SSL连接进行安全防护。

常见的浏览器（例如Mozilla Firefox和Google Chrome）都提供支持HSTS。对于担心窃听攻击的用户而言，它仍然非常有用。

如果不强制在所有用户上使用HSTS，则Web开发人员至少应让用户选择启用它，如果他们希望使用它。

有关HSTS的更多详细信息，请访问：

- [Wikipedia中的HTTP严格传输安全性](https://en.wikipedia.org/wiki/HTTP_Strict_Transport_Security)。
- 用于[HSTS RFC的IETF](https://tools.ietf.org/html/rfc6797)。
- [OWASP Appsec教程系列-第4集：严格的传输安全性](http://www.youtube.com/watch?v=zEV3HOuM_Vw)

### 数字证书固定

证书固定是在用户代理（网络浏览器，移动应用程序或浏览器插件）中硬编码或存储数字证书/公共密钥的预定义信息集（通常为哈希）。这种操作使浏览器等仅存储预定义证书或公共密钥，即使用户信任（隐式或显式）其他证书/公钥，所有其他证书也会不能用于数据加密等操作。

固定的一些优点是：

- 如果发生CA破坏，则用户信任的受到破坏的CA可以为任何域颁发证书，从而允许邪恶的犯罪分子窃听用户。
- 在用户被迫接受潜在恶意的根CA的环境中，例如公司环境或国家PKI方案。
- 在目标受众可能不了解证书警告的应用程序中，并且可能仅允许使用任何无效的证书。

有关证书固定的详细信息，请参阅以下内容：

- OWASP Pinning_Cheat_Sheet 
- [HTTP RFC的公钥固定扩展](https://tools.ietf.org/html/rfc7469)。
- [保护SSL通道免受中间​​人攻击：未来技术-HTTP严格传输安全性和证书固定。](https://owasp.org/www-pdf-archive/OWASP_defending -MITMA_APAC2012.pdf)

### Panic 模式

Panic 模式是受威胁的用户，在泄露其帐户凭据时可参考的模式。

为用户提供创建panic模式的能力可以帮助他们度过这些威胁，尤其是在世界动荡的地区。不幸的是，世界各地的许多用户都受到大多数Web开发人员不知道或未考虑到的威胁类型的威胁。

Panic 模式的示例包括受困用户可以在受到威胁时删除其数据，登录到虚假的收件箱/帐户/系统或调用触发器以备份/上传/隐藏敏感数据的模式。

根据应用程序类型的不同，实现的适当紧急模式也会有所不同。诸如VeraCrypt之类的磁盘加密软件可能会实施Panic 模式，如果用户输入了麻烦的密码，则会启动伪造的系统分区。

电子邮件提供商可能会实施一种紧急模式，该模式隐藏预定义的敏感电子邮件或联系人，从而仅允许阅读无害的电子邮件（通常由用户定义），同时防止紧急模式超过实际帐户。

关于Panic 模式的一个重要说明是，即使根本不能轻易发现它们。受害者的Panic 模式中的对手一定不能以任何方式或尽可能少的方式找出真相。这意味着，一旦进入紧急模式，必须允许大多数不敏感的常规操作继续进行（例如发送或接收电子邮件），并且必须能够从原始紧急模式内部创建其他紧急模式（如果对手尝试了在受害者的Panic 模式下创建Panic 模式并失败，对手会知道他们已经处于Panic 模式，并可能试图伤害受害者。

另一种解决方案是防止从用户帐户生成Panic 模式，而使对手更难以欺骗。例如，只能在带外创建，并且对手必须无法得知该特定帐户已经存在Panic 模式。

实施Panic 模式必须始终旨在迷惑对手并阻止他们到达受害者的实际帐户/敏感数据，并防止发现特定帐户的任何现有Panic 模式。

有关VeraCrypt隐藏的操作系统模式的更多详细信息，请参阅：[VeraCrypt隐藏操作系统](https://www.veracrypt.fr/en/Hidden%20Operating%20System.html)。

### 远程会话无效

如果用户设备丢失，被盗或被没收，或怀疑是饼干被盗；对于用户来说，能够查看他们当前的在线会话并断开/取消任何可疑的延迟会话，尤其是属于被盗或没收设备的会话，可能会非常有益。如果用户怀疑其会话详细信息在中间人攻击中被盗，则远程会话无效也可以提供帮助。

有关会话管理的详细信息，请参阅：

-[OWASP会话管理备忘单]（Session_Management_Cheat_Sheet.md）。

### 允许来自匿名网络的连接

诸如Tor项目之类的匿名网络为世界各地动荡地区的用户提供了逃避监视，访问信息或突破审查障碍的千载难逢的机会。陷入困境的地区的激进分子经常使用此类网络来举报不公正行为或向世界其他地方发送未经审查的信息，尤其是诸如社交网络，媒体流网站和电子邮件提供商之类的媒体。

Web开发人员和网络管理员必须采取各种途径，使用户能够从此类网络后面访问服务，并且针对此类匿名网络制定的任何政策都必须仔细评估，以评估其对世界各地人们的影响。

如果可能，应用程序开发人员应尝试将其应用程序与这些匿名网络集成或实现轻松耦合，例如支持SOCKS代理或集成库（例如Android的OnionKit）。

有关匿名网络及其提供的用户保护的更多信息，请参考：

- [Tor项目](https://www.torproject.org)。
- [I2P网络](http://www.i2p2.de)。
- [OnionKit：增强Android应用程序中的网络安全性和加密](https://github.com/guardianproject/OnionKit)。

### 防止IP地址泄漏

在用户保护范围内，防止用户IP地址泄漏非常重要。托管外部第三方内容（例如头像，签名或照片附件）的任何应用程序；必须考虑允许用户阻止第三方内容加载到应用程序页面中的好处。

如果可以在用户的​​供稿或时间轴中嵌入第三方外部域图像；攻击者可能会使用它通过将受害者托管在受害者的域中来发现受害者的真实IP地址，并监视该图像的HTTP请求。

许多Web应用程序都需要用户内容来进行操作，这完全可以作为业务流程接受；但是，建议Web开发人员考虑为用户提供阻止外部内容的选项，以防万一。这主要适用于社交网络和论坛，但是也可以适用于基于Web的电子邮件，其中可以将图像嵌入HTML格式的电子邮件中。

在包含第三方图像的HTML格式的电子邮件中也存在类似的问题，但是默认情况下，大多数电子邮件客户端和提供程序都阻止加载第三方内容。为用户提供更好的隐私和匿名保护。

### 诚实与透明

如果Web应用程序无法为用户提供足够的法律或政治保护，或者Web应用程序无法防止滥用或泄露敏感信息（例如日志），则必须以清晰易懂的形式将事实告知用户，以便用户可以对他们是否应该使用该特定服务做出明智的选择。

如果不违反法律，请告知用户外部实体是否要求删除或调查他们的信息。

诚实在培养Web应用程序与其用户之间的信任文化方面有很长的路要走，它使世界各地的许多用户可以仔细权衡其选择，从而防止对世界各地不同地区的用户造成伤害。

有关安全日志记录的更多见解，请访问：

-[OWASP记录备忘单]（Logging_Cheat_Sheet.md）