# 中断

中断，是触发执行特定类型程序的某一事件。

具体执行的类型程序，被称为Interrupt Service Routine ，ISR，也称为中断处理程序。

在实模式下，内存第一个千字（0x0000~0x03ff）中存放了ISR的地址，被称为中断向量表（IVT）；保护模式下，被称为中断描述表 IDT。两者意思类似。


x86 32bit IVT：
- 每4个字节一个ISR的地址，所以1024中有256个ISR地址
- 前两个字节（例如：地址0x0000~0x0001）存放ISR的有效地址LA
- 后两个字节（例如：地址0x0002~0x0003）存放ISR的段选择地址
- 每两个字节中，高位地址放ISR地址的高位；低位地址放ISR的地址低位。


有三类中断：
- 硬件故障（可屏蔽 or 不可屏蔽）
- 软件中断
  - 由INT指令实现
- 异常（故障、陷阱、终止）
  - 故障，例如除数为0，处理器在产生异常的指令之前的边界报告异常，这样程序可以恢复状态，或重新执行这条指令。
  - 陷阱，重新执行指令是不行的。处理器在产生异常的指令之后的边界报告异常，这样程序可以跳出陷阱。例如3号“断点”中断，4号“算术溢出”中断
  - 终止，是没有希望的异常。出现时，程序被终止。 




## INT

INT 是x86处理器的汇编语言指令，用于产生一个软件中断。

格式： `INT 立即数`

软件中断的含义是当执行中断时，系统会调用预制的某个程序（x86中256个预制程序之一），在 Real mode 下，这些程序存放在内存最低地址开始的1024字节内。

最常用的DoS中断是 INT 0x21，使用不同参数调用它，可以完成各种IO 操作，字符串输出等。

下列例子调用DOS中断，显示字母‘A’：
```s
mov ah,02h
mov dl,41h
int 21h
```

INT指令执行以下动作：
- 令陷阱标志 TF=0，中断允许标志 IF=0
- 将FLAGS、CS、IP依次放入堆栈；
- 转移到具体的中断向量指定的ISR地址
- 执行ISR代码直到遇到IRET

IRET指令正好与INT指令相反。

类UNIX系统下，最常用的不是软件中断，而是异常中断，即 INT 0x80，也称为 sysctem call/syscall。这时会将系统内核对应的一个 32-bit 值（不同的值对应不同功能）放入 EAX 寄存器，并设置各种参数，最后通过INT 0x80实现功能。

## INT3

INT3 在x86中的机器码为 0xcc ,与其他 `INT 立即数`（机器吗 0xCD 立即数） 为二字节指令不同，它是一个单字节指令。

INT3 主要用于调试程序，单字节更便于插入指令序列中，并被处理器识别。

## INTO

INTO 指令（机器码 0xCE）是另一个单字节指令，是一个条件中断指令，当 overflow 标志为1时触发。

