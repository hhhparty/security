# OWASP 通用移动app测试指南

与平台特性无关的测试项目包括：

- 移动应用认证架构测试
- 网络通信测试
- 移动app的密码学测试
- 代码质量测试
- 篡改和逆向工程测试
- 用户教育测试

## Mobile App Authentication Architectures

没有万能的身份验证方法，在测试app的身份验证架构时，首先要考虑在给定环境下，验证方法是否合适。身份验证可以基于以下内容：

- 用户所知
- 用户所有
- 用户生物特征

对于含有敏感信息的app，需要添加2因子身份验证。

可以选择使用OWASP Mobile AppSec 验证标准作为准则。

web应用通常将状态认证与存储在客户端cookie中的随机会话id一起使用，但移动app更多的使用无状态基于令牌的方法进行认证。无状态认证中，所有用户识别信息都存储在客户端令牌中，令牌可以传递到任何服务器或微服务，无需服务器上维护会话状态。无状态身份验证通常会分解到授权服务器，授权服务器会在用户登录时生成、签名并可选择的加密令牌。

移动应用可能用到补充认证：
- 地理位置
- IP地址
- 时间
- 使用的设备

在验证过程中，有下列验证内容

### 验证有适当的认证（MSTG-ARCH-2 AND MSTG-AUTH-1)

测试身份验证和授权时，执行下列步骤：
- 确定应用程序使用的其他身份验证因素
- 找到关键功能端点
- 验证是否在所有服务器上都严格执行了其他因素

### 密码的最佳测试方法（MSTG-AUTH-5 AND MSTG-AUTH-6）

使用密码进行身份验证，密码强度是关键。


#### 静态分析法

根据 [OWASP 认证验证备忘单](https://github.com/OWASP/CheatSheetSeries/blob/master/cheatsheets/Authentication_Cheat_Sheet.md#implement-proper-password-strength-controls)，确认密码复杂性满足要求。重点是长度和无限制的字符集。

#### 使用 zxcvb 工具检查密码强度

[zxcvb](https://github.com/dropbox/zxcvbn) 是可用于估计密码强度的工具。

#### 使用 PwnedPasswords 检查密码是否已被泄露

查看 https://haveibeenpwned.com/ 了解是否已被脱裤。

#### 登录限制设置

防止暴力破解。

### 动态测试（MSTG-AUTH-6)

可以采用多种方法，执行自动密码猜测攻击。对于HTTP/https采用拦截代理是一个不错的选择。

工具可以使用burpsuite owasp zap等。

### 会话管理最佳实践

找到提供敏感信息功能所有的服务器端点，验证是否有一致的验证和授权。

确保：
- 会话ID是随机产生的
- 不能轻易猜出这些ID（有适当的长度和熵）
- 会话ID总是通过安全连接（https）进行交互
- 移动应用不会将会话ID 保持在持久性存储中
- 每当用户尝试访问特权资源时，服务器都要验证会话，id必须正确、有权访问资源。
- 会话在服务器端终止，并在超时或用户注销后在移动app中删除会话信息。

身份验证功能不应从头开发，应建立在经过验证的框架之上。例如：
- spring
- struts
- laravel
- ruby on rails

### 测试会话超时（MSTG-AUTH-7)

最小化会话id和令牌的生存期，可以减少成功劫持账号的可能性。

建议时间在10分钟到2小时之间。

可以采用静态分析（看配置）和动态分析（代理拦截检查）方法。

### 测试用户注销（MSTG-AUTH-4)

验证注销是否有效，终止了客户端和服务器的连接，无状态令牌是否还有效。

许多应用不会自动注销用户。

未完....

