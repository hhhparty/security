# OWASP Mobile Application Security Verification Standard  

MASVS 是一个社区项目，其宗旨是建立一个安全需求的框架给人们去设计、开发和测试iOS和Android的移动应用程序。


我们的手机和其应用程序存储并处理我们的个人信息、照片、录音录像、笔记、银行账户信息、商业信息以及卫星定位等等。所以保证数据安全就相当于保证了移动安全。手机应用程序一般以客户端的形式存在以连接到我们日常使用的服务处理终端，处理我们与外界交换的每条信息。入侵了一个人的智能手机，就相当于得到对这个人的生活的所有信息。相较于电脑，智能手机的移动设备更容易丢失或被盗。随着移动恶意软件愈演愈烈，对移动数据保护的需求就愈发显著。

因此，移动应用的安全标准必须侧重于移动应用如何处理、存储和保护敏感信息。作为现代移动操作系统，iOS和安卓都为数据的存储与通讯安全提供了很好的API。但是，确保安全的前提是这些API都被正确地使用。数据存储、应用间通信、正确使用加密API和安全网络通信只是需要仔细考虑的一些方面而已。

需要业界共识的一个重要问题是，在保护数据的机密性和完整性方面究竟应该做到多严谨。例如，我们大多数人会认为移动应用应该在TLS交换中验证服务器证书。但是，SSL证书绑定呢？不这样做会导致漏洞的产生吗？如果移动应用程序处理敏感数据，这应是一项要求，还是可能会适得其反？另一种情况是，操作系统对应用程序进行沙盒保护，我们是否需要加密SQLite中的数据？适合一个应用的安全需求可能对于另一个应用来说不切实际。MASVS试图使用适合不同威胁情况的验证级别来标准化这些要求。

此外，具有系统权限的恶意软件和远程控制黑客软件的出现使人们意识到移动操作系统本身存在可利用的缺陷。因此，容器化策略被越来越多地用于提供对于敏感数据的保护和防止对于客户端的篡改。硬件级的安全功能和操作系统级的容器化解决方案（如 Android For Work和三星Knox）确实存在，但它们在不同设备上并非都可以使用。作为一种辅助措施，软件级别的措施可以提供相对有效的保护效用，但是目前没有标准或测试流程来验证这些类型的保护。

因此，移动应用安全测试报告各式各样：例如，一些测试人员把安卓移动应用程序中缺乏代码混淆或root检测认定为"安全漏洞"。另一方面，一些测试人员认为字符串加密、调试器检测或控制流混淆等措施为非必要措施。因为事情并非非黑即白的，这种不考虑实际情况的判断的缺乏实际意义。移动应用程序的韧性要求取决于一个它面临的移动客户端的威胁。软件保护并非毫无用处，它们最终可能会被绕过，因此不能将软件保护用作安全控制的替代品。

**MASVS的总体目标是为移动应用程序安全提供基础需求（MASVS-L1），同时包括了额外的纵深防御措施（MASVS-L2） 和针对移动应用程序客户端威胁的保护（MASVS-R）。**

MASVS旨在实现以下目标：

- 罗列出移动应用安全开发的需求，以供软件架构师和开发人员使用;
- 提供可用于移动应用安全测试的行业标准;
- 阐明软件保护机制在移动安全中的作用，并提供验证其有效性的要求;
- 提出针对不同用例的安全级别的具体建议。

## 目标

MASVS 可以被用于确立移动应用程序的安全程度。此标准(MASVS)的建立遵循了下面三个主要目标：

- 可用于业界应用的安全度量标准 - 提供一个安全标准，让开发者和使用者们可以比较现有的移动应用程序；
- 可用于指导纲领 - 为移动应用程序整个开发阶段和测试提供安全指引；
- 可用于采购检验的验证参考 - 提供一个移动应用程序安全的验证标准。

## 移动应用安全模型 (Mobile AppSec Model)
MASVS定义了两个安全验证级别（MASVS-L1 和 MASVS-L2），以及一系列的抵抗逆向工程防御韧性准则（MASVS-R）。 

- MASVS-L1是建议所有的移动应用程序都应该遵守的要求；满足MASVS-L1中所提到的要求，可以确保移动应用程序的安全，使开发流程符合信息安全的最佳实践方法，并且确保移动应用程序可以防御常见的安全问题。


- MASVS-L2则针对的是处理高度敏感数据的移动应用程序。MASVS-L2添加了额外的纵深防御（defense-in-depth），例如证书绑定（SSL pinning）。因此，MASVS-L2可以使移动应用程序能够更好的防范复杂的攻击行为 - 假设移动操作系统的安全控件完好无损，并且最终用户不被视为潜在的恶意用户。


- MASVS-R提供了需要防范客户端威胁时可以使用的额外防护管控方法。满足全部或者部分的MASVS-R软件保护要求，可以帮助阻止特定的客户端威胁，包括最终用户是恶意用户或者手机操作系统遭到破坏的情况。

I: 虽然我们建议应该在每一个移动应用程序中实施MASVS-L1准则，但是否实施最终应是基于风险的决策，该决策应与软件所有者沟通。

II: 请注意，MASVS-R和<OWASP移动安全性测试指南>中所提到的软件保护准则无法确保不被绕过，绝对不能用作安全管控的替代品。相反的，这些软件保护准则旨在增加已落实MASVS-L1或MASVS- L2的移动应用程序，针对特定的威胁提供额外的防御。

总而言之，可以使用如下的验证类别组合：

- MASVS-L1
- MASVS-L1+R
- MASVS-L2
- MASVS-L2+R
  
不同的验证类别组合反映出不同的安全等级和弹性。这样的组合方式是为了让安全具有灵活性，例如：手机移动游戏程序出于可用性的需求，可能不需要加入MASVS-L2的安全控制机制，如：双因子身份验证，但是在防篡改方面会存在强烈的业务需求。

### 举例
MASVS-L1
应用于所有的移动应用程序。MASVS-L1列举了在不过分影响开发成本以及用户体验下的最佳安全实践方法。任何不适用于更严格安全等级的移动应用程序应该采用MASVS-L1标准。
MASVS-L2
医疗保健行业：存储个人身份信息的移动应用程序，因为这些信息可被用于身份盗窃，诈骗钱财或者其他的欺骗行为，所以应采用MASVS-L2。对于美国的医疗保健行业，需要遵守相关的信息保密法规 - 《健康保险可移植性和责任法案》（HIPAA）中的隐私权，安全性，违约通知规则和患者安全规则。

金融行业：可以访问和处理高度敏感信息（例如：信用卡卡号，个人信息或者转账功能）的移动应用程序。这些移动应用程序需要有额外的安全控制措施来防止欺诈行为。金融业相关的应用程序需确保遵守支付卡行业数据安全标准（PCI DSS），《格莱姆·里奇·布利利法案》和《萨班斯-奥克斯利法案》（SOX）。

MASVS L1+R
以知识产权（IP）保护为商业目标的移动应用程序。MASVS-R中列举的韧性控制可以用于增加攻击者获取源代码，篡改以及破解的难度。

游戏行业：游戏应用程序对于防篡改和作弊有着强烈的需求，例如在线竞技游戏。游戏作弊对于在线游戏来说，是一个至关重要的问题，因为大量作弊者的存在，会导致其他玩家的不满，并且最终导致整个游戏的失败。MASVS-R提供了基础的防篡改控件，从而增加游戏作弊者的工作量。

MASVS L2+R
金融产业：允许用户执行转账操作的手机银行应用程序，存在代码注入和在被不安全设备中运行的风险。在这种情况下，可以使用MASVS-R的安全管控机制了来防止篡改，从而提高恶意程序开发者的门槛。

所有在移动设备中需要存储敏感数据，以及支持不同种类的移动设备和操作系统的移动应用程序，建议采用MASVS L2+R。在这种情况下，安全控制机制可以被用来提高纵深防御，从而增加攻击者提取机密数据的难度。

带有内购功能的程序，建议采用服务端和MASVS L2来保护付费内容。但是，在某些情况下，无法使用服务端保护。在这些情况下，应该使用MASVS-R来增加逆向和篡改的难度。

## 评估与认证

### 移动应用程序的认证指南
移动应用安全认证标准（MASVS）推荐测试人员通过“Open Book”的方式对移动应用进行验证。也就是说，测试人员需要取得所有关于被测试应用的关键信息，比如，程序设计和开发人员的信息，项目文档，源码，用户服务登录权限，以及每个用户类别至少一个测试用户的用户名和密码。

需要注意的是，MASVS涵盖移动应用程序客户端的安全性，应用程序与其远程端点之间的网络通信，以及与用户身份验证和会话管理相关的一些基本和通用需求。它不包含对应用程序相关联的远程服务(例如web服务)的特定要求，以及与身份验证和会话管理相关的通用要求。威胁建模必须涵盖MASVS V1指定远程服务，并根据例如OWASP ASVS的相关标准进行验证。

提供认证的机构必须在所有的报告中阐明以下几点：
- 认证的范围（特别是在关键的模块不在认证的范围中时）
- 认证结果的总结（包含通过的和未通过的测试项目）并清楚阐明如何改进未通过的项目。
- 业界的标准做法也要求测试人员保存详细的工作记录，截屏，录屏，可以复现的具体攻击过程，电子记录，网络代理的记录以及其他相关的笔记（例如目标服务器中待清理文件的清单）。仅仅报告自动化工具发现的问题是远远不够的，因为这样做，无法证明所有需认证的项目都已经经过了详细的测试。在出现争议的情况下，认证机构必须能够提供足够的证据来证明每一个验证的需求都经过了测试。

### 使用OWASP移动安全测试指南（MSTG）
OWASP MSTG是用于测试移动应用程序安全性的手册。它描述了验证MASVS中列出的相关安全准则的技术过程。MSTG提供了一个测试案例的列表，每个测试案例都映射到MASVS中的一个安全准则。相比MASVS对于安全准则的通用性和一般性的描述，MSTG提供了基于不同移动操作系统的详细建议以及测试流程。

### 自动化安全测试工具的作用
使用自动化扫描工具对移动应用程序进行静态与动态的扫描可以提升应用程序安全测试的效率。但是，仅仅通过使用自动化工具来进行对MASVS验证是不切实际的。因为每个移动应用程序都是不一样的。此外，了解应用程序的总体架构、业务逻辑和以及相关技术框架的缺点，是验证移动应用程序安全性的必要条件。

### 其他用途
#### 作为详细的安全架构指南
MASVS可以用来作为安全架构师的参考资料。SABSA与TOGAF，作为目前两个主流的的安全架构框架，缺少了很多关于移动安全架构评估的必要信息，而MASVS填补了这方面的空白。安全架构师可以使用MASVS作为参考，进行移动应用程序的安全设计。

作为安全编程检查清单
MASVS定义了两个安全检查级别用来对应不同的安全需求。相关单位可以按照自身需求自行定义对其适用的安全检查清单。相关单位还可以Fork MASVS 的 GitHub Repository来制定符合其自身需求的安全标准。注意由于MASVS可能进行更新，需要维护Fork版本的可追溯性。 也就是说，假如一个移动应用程序通过了安全测试准则4.1，随着MASVS的更新，此应用程序也通过的更新版本的安全测试准则4.1。

作为移动安全测试的基准
一套完整的移动安全测试方法应该包括所有MASVS列出的安全准则。OWASP移动安全测试指南(MSTG)对每个安全准则的验证需求都给出了黑盒与白盒测试的相关案例。

作为自动化单元和集成测试的指南
除了应用架构之外,大多数MASVS的安全准则，都是可以测试的。MASVS所定义的安全准则都可作为自动化单元测试、集成测试和验收测试集成到持续的软件开发生命周期中。这不仅有助于提升开发人员的安全意识，还提高了最终应用程序的整体质量，并有利于在软件发布早期的安全测试中减少安全漏洞的数量。

作为安全开发培训的参考资料
MASVS还可以用来定义移动应用程序的安全特性。市面上很多“安全编程”的课程不过是传授一些黑客技巧顺带加一点安全编程的小提示。这样的课程因其覆盖面的局限性因此对开发人员没有很大的帮助。移动开发安全课程可以参考MASVS进行制定，在覆盖十大代码安全问题的同时，重点关注与强调MASVS中提及的主动安全防护控制。